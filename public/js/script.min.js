(function(a){a.Jcrop=function(b,e){function h(a){return Math.round(a)+"px"}function C(c){c=a(c).offset();return[c.left,c.top]}function x(a){return[a.pageX-K[0],a.pageY-K[1]]}function B(b){"object"!==typeof b&&(b={});c=a.extend(c,b);a.each(["onChange","onSelect","onRelease","onDblClick"],function(a,b){"function"!==typeof c[b]&&(c[b]=function(){})})}function pa(a,c,b){K=C(s);P.setCursor("move"===a?a:a+"-resize");if("move"===a)return P.activateHandlers(la(c),T,b);c=z.getFixed();var l=da(a),f=z.getCorner(da(l));
z.setPressed(z.getCorner(l));z.setCurrent(f);P.activateHandlers(d(a,c),T,b)}function d(a,b){return function(d){if(c.aspectRatio)switch(a){case "e":d[1]=b.y+1;break;case "w":d[1]=b.y+1;break;case "n":d[0]=b.x+1;break;case "s":d[0]=b.x+1}else switch(a){case "e":d[1]=b.y2;break;case "w":d[1]=b.y2;break;case "n":d[0]=b.x2;break;case "s":d[0]=b.x2}z.setCurrent(d);u.update()}}function la(a){var c=a;na.watchKeys();return function(a){z.moveOffset([a[0]-c[0],a[1]-c[1]]);c=a;u.update()}}function da(a){switch(a){case "n":return"sw";
case "s":return"nw";case "e":return"nw";case "w":return"ne";case "ne":return"sw";case "nw":return"se";case "se":return"nw";case "sw":return"ne"}}function Y(a){return function(b){if(c.disabled||"move"===a&&!c.allowMove)return!1;K=C(s);Z=!0;pa(a,x(b));b.stopPropagation();b.preventDefault();return!1}}function U(a,c,b){var d=a.width(),l=a.height();d>c&&0<c&&(d=c,l=c/a.width()*a.height());l>b&&0<b&&(l=b,d=b/a.height()*a.width());E=a.width()/d;G=a.height()/l;a.width(d).height(l)}function J(a){return{x:a.x*
E,y:a.y*G,x2:a.x2*E,y2:a.y2*G,w:a.w*E,h:a.h*G}}function T(a){a=z.getFixed();a.w>c.minSelect[0]&&a.h>c.minSelect[1]?(u.enableHandles(),u.done()):u.release();P.setCursor(c.allowSelect?"crosshair":"default")}function ea(a){if(c.disabled||!c.allowSelect)return!1;Z=!0;K=C(s);u.disableHandles();P.setCursor("crosshair");var b=x(a);z.setPressed(b);u.update();P.activateHandlers(L,T,"touch"===a.type.substring(0,5));na.watchKeys();a.stopPropagation();a.preventDefault();return!1}function L(a){z.setCurrent(a);
u.update()}function V(){var b=a("<div></div>").addClass(c.baseClass+"-tracker");aa&&b.css({opacity:0,backgroundColor:"white"});return b}function ba(a){ca([a[0]/E,a[1]/G,a[2]/E,a[3]/G]);c.onSelect.call(M,J(z.getFixed()));u.enableHandles()}function ca(a){z.setPressed([a[0],a[1]]);z.setCurrent([a[2],a[3]]);u.update()}function fa(){c.disabled=!0;u.disableHandles();u.setCursor("default");P.setCursor("default")}function ma(){c.disabled=!1;H()}function W(b,d,l){d=d||c.bgColor;c.bgFade&&a.fx.step.hasOwnProperty("backgroundColor")&&
c.fadeTime&&!l?b.animate({backgroundColor:d},{queue:!1,duration:c.fadeTime}):b.css("backgroundColor",d)}function H(a){c.allowResize?a?u.enableOnly():u.enableHandles():u.disableHandles();P.setCursor(c.allowSelect?"crosshair":"default");u.setCursor(c.allowMove?"move":"default");c.hasOwnProperty("trueSize")&&(E=c.trueSize[0]/r,G=c.trueSize[1]/q);c.hasOwnProperty("setSelect")&&(ba(c.setSelect),u.done(),delete c.setSelect);X.refresh();c.bgColor!=qa&&(W(c.shade?X.getShades():F,c.shade?c.shadeColor||c.bgColor:
c.bgColor),qa=c.bgColor);ga!=c.bgOpacity&&(ga=c.bgOpacity,c.shade?X.refresh():u.setBgOpacity(ga));ha=c.maxSize[0]||0;ia=c.maxSize[1]||0;ja=c.minSize[0]||0;ka=c.minSize[1]||0;c.hasOwnProperty("outerImage")&&(s.attr("src",c.outerImage),delete c.outerImage);u.refresh()}var c=a.extend({},a.Jcrop.defaults),K,Q=navigator.userAgent.toLowerCase(),aa=/msie/.test(Q),A=/msie [1-6]\./.test(Q);"object"!==typeof b&&(b=a(b)[0]);"object"!==typeof e&&(e={});B(e);var Q={border:"none",visibility:"visible",margin:0,
padding:0,position:"absolute",top:0,left:0},p=a(b),D=!0;if("IMG"==b.tagName){if(0!=p[0].width&&0!=p[0].height)p.width(p[0].width),p.height(p[0].height);else{var I=new Image;I.src=p[0].src;p.width(I.width);p.height(I.height)}var s=p.clone().removeAttr("id").css(Q).show();s.width(p.width());s.height(p.height());p.after(s).hide()}else s=p.css(Q).show(),D=!1,null===c.shade&&(c.shade=!0);U(s,c.boxWidth,c.boxHeight);var r=s.width(),q=s.height(),F=a("<div />").width(r).height(q).addClass(c.baseClass+"-holder").css({position:"relative",
backgroundColor:c.bgColor}).insertAfter(p).append(s);c.addClass&&F.addClass(c.addClass);var N=a("<div />"),l=a("<div />").width("100%").height("100%").css({zIndex:310,position:"absolute",overflow:"hidden"}),k=a("<div />").width("100%").height("100%").css("zIndex",320),y=a("<div />").css({position:"absolute",zIndex:600}).dblclick(function(){var a=z.getFixed();c.onDblClick.call(M,a)}).insertBefore(s).append(l,k);D&&(N=a("<img />").attr("src",s.attr("src")).css(Q).width(r).height(q),l.append(N));A&&
y.css({overflowY:"hidden"});var v=c.boundary,R=V().width(r+2*v).height(q+2*v).css({position:"absolute",top:h(-v),left:h(-v),zIndex:290}).mousedown(ea),qa=c.bgColor,ga=c.bgOpacity,ha,ia,ja,ka,E,G,Z,oa,ra;K=C(s);var O=function(){function a(){var c={},b=["touchstart","touchmove","touchend"],d=document.createElement("div"),l;try{for(l=0;l<b.length;l++){var w=b[l],w="on"+w,n=w in d;n||(d.setAttribute(w,"return;"),n="function"==typeof d[w]);c[b[l]]=n}return c.touchstart&&c.touchend&&c.touchmove}catch(k){return!1}}
var b;b=!0===c.touchSupport||!1===c.touchSupport?c.touchSupport:a();return{createDragger:function(a){return function(b){if(c.disabled||"move"===a&&!c.allowMove)return!1;K=C(s);Z=!0;pa(a,x(O.cfilter(b)),!0);b.stopPropagation();b.preventDefault();return!1}},newSelection:function(a){return ea(O.cfilter(a))},cfilter:function(a){a.pageX=a.originalEvent.changedTouches[0].pageX;a.pageY=a.originalEvent.changedTouches[0].pageY;return a},isSupported:a,support:b}}(),z=function(){function a(){if(!c.aspectRatio){var b=
w-f,S=n-g;ha&&Math.abs(b)>ha&&(w=0<b?f+ha:f-ha);ia&&Math.abs(S)>ia&&(n=0<S?g+ia:g-ia);ka/G&&Math.abs(S)<ka/G&&(n=0<S?g+ka/G:g-ka/G);ja/E&&Math.abs(b)<ja/E&&(w=0<b?f+ja/E:f-ja/E);0>f&&(w-=f,f-=f);0>g&&(n-=g,g-=g);0>w&&(f-=w,w-=w);0>n&&(g-=n,n-=n);w>r&&(b=w-r,f-=b,w-=b);n>q&&(b=n-q,g-=b,n-=b);f>r&&(b=f-q,n-=b,g-=b);g>q&&(b=g-q,n-=b,g-=b);return l(d(f,g,w,n))}var b=c.aspectRatio,S=c.minSize[0]/E,k=c.maxSize[0]/E,y=w-f,e=n-g,t=Math.abs(y),m=Math.abs(e);0===k&&(k=10*r);t/m<b?(t=n,m*=b,m=0>y?f-m:m+f,0>
m?(m=0,t=Math.abs((m-f)/b),t=0>e?g-t:t+g):m>r&&(m=r,t=Math.abs((m-f)/b),t=0>e?g-t:t+g)):(m=w,t/=b,t=0>e?g-t:g+t,0>t?(t=0,m=Math.abs((t-g)*b),m=0>y?f-m:m+f):t>q&&(t=q,m=Math.abs(t-g)*b,m=0>y?f-m:m+f));m>f?(m-f<S?m=f+S:m-f>k&&(m=f+k),t=t>g?g+(m-f)/b:g-(m-f)/b):m<f&&(f-m<S?m=f-S:f-m>k&&(m=f-k),t=t>g?g+(f-m)/b:g-(f-m)/b);0>m?(f-=m,m=0):m>r&&(f-=m-r,m=r);0>t?(g-=t,t=0):t>q&&(g-=t-q,t=q);return l(d(f,g,m,t))}function b(a){0>a[0]&&(a[0]=0);0>a[1]&&(a[1]=0);a[0]>r&&(a[0]=r);a[1]>q&&(a[1]=q);return[Math.round(a[0]),
Math.round(a[1])]}function d(a,b,c,l){var g=a,f=c,k=b,n=l;c<a&&(g=c,f=a);l<b&&(k=l,n=b);return[g,k,f,n]}function l(a){return{x:a[0],y:a[1],x2:a[2],y2:a[3],w:a[2]-a[0],h:a[3]-a[1]}}var f=0,g=0,w=0,n=0,k,y;return{flipCoords:d,setPressed:function(a){a=b(a);w=f=a[0];n=g=a[1]},setCurrent:function(a){a=b(a);k=a[0]-w;y=a[1]-n;w=a[0];n=a[1]},getOffset:function(){return[k,y]},moveOffset:function(a){var b=a[0];a=a[1];0>f+b&&(b-=b+f);0>g+a&&(a-=a+g);q<n+a&&(a+=q-(n+a));r<w+b&&(b+=r-(w+b));f+=b;w+=b;g+=a;n+=
a},getCorner:function(b){var c=a();switch(b){case "ne":return[c.x2,c.y];case "nw":return[c.x,c.y];case "se":return[c.x2,c.y2];case "sw":return[c.x,c.y2]}},getFixed:a}}(),X=function(){function b(){return d(z.getFixed())}function d(a){p.top.css({left:h(a.x),width:h(a.w),height:h(a.y)});p.bottom.css({top:h(a.y2),left:h(a.x),width:h(a.w),height:h(q-a.y2)});p.right.css({left:h(a.x2),width:h(r-a.x2)});p.left.css({width:h(a.x)})}function l(){return a("<div />").css({position:"absolute",backgroundColor:c.shadeColor||
c.bgColor}).appendTo(v)}function k(){e||(e=!0,v.insertBefore(s),b(),u.setBgOpacity(1,0,1),N.hide(),f(c.shadeColor||c.bgColor,1),u.isAwake()?y(c.bgOpacity,1):y(1,1))}function f(a,b){W(n(),a,b)}function g(){e&&(v.remove(),N.show(),e=!1,u.isAwake()?u.setBgOpacity(c.bgOpacity,1,1):(u.setBgOpacity(1,1,1),u.disableHandles()),W(F,0,1))}function y(a,b){e&&(c.bgFade&&!b?v.animate({opacity:1-a},{queue:!1,duration:c.fadeTime}):v.css({opacity:1-a}))}function n(){return v.children()}var e=!1,v=a("<div />").css({position:"absolute",
zIndex:240,opacity:0}),p={top:l(),left:l().height(q),right:l().height(q),bottom:l()};return{update:b,updateRaw:d,getShades:n,setBgColor:f,enable:k,disable:g,resize:function(a,b){p.left.css({height:h(b)});p.right.css({height:h(b)})},refresh:function(){c.shade?k():g();u.isAwake()&&y(c.bgOpacity)},opacity:y}}(),u=function(){function b(c,d){var l=a("<div />").mousedown(Y(c)).css({cursor:c+"-resize",position:"absolute",zIndex:d}).addClass("ord-"+c);O.support&&l.bind("touchstart.jcrop",O.createDragger(c));
k.append(l);return l}function d(a){var c;for(c=0;c<a.length;c++)b(a[c],B++).addClass("jcrop-dragbar")}function e(b){var d,g;for(g=0;g<b.length;g++){switch(b[g]){case "n":d="hline";break;case "s":d="hline bottom";break;case "e":d="vline right";break;case "w":d="vline"}var f=R,k=b[g],n=d,n=a("<div />").css({position:"absolute",opacity:c.borderOpacity}).addClass(c.baseClass+"-"+n);l.append(n);f[k]=n}}function v(a){var d;for(d=0;d<a.length;d++){var l=x,g=a[d],f=c.handleSize,k=b(a[d],B++).css({opacity:c.handleOpacity}).addClass(c.baseClass+
"-handle");f&&k.width(f).height(f);l[g]=k}}function f(){var a=z.getFixed();z.setPressed([a.x,a.y]);z.setCurrent([a.x2,a.y2]);g()}function g(a){if(r)return w(a)}function w(a){var b=z.getFixed(),d=b.h;y.width(Math.round(b.w)).height(Math.round(d));var d=b.x,l=b.y;c.shade||N.css({top:h(-l),left:h(-d)});y.css({top:h(l),left:h(d)});c.shade&&X.updateRaw(b);r||(y.show(),c.shade?X.opacity(ga):n(ga,!0),r=!0);a?c.onSelect.call(M,J(b)):c.onChange.call(M,J(b))}function n(a,b,d){if(r||b)c.bgFade&&!d?s.animate({opacity:a},
{queue:!1,duration:c.fadeTime}):s.css("opacity",a)}function p(){t=!0;if(c.allowResize)return k.show(),!0}function q(){t=!1;k.hide()}function u(a){a?(oa=!0,q()):(oa=!1,p())}var r,B=370,R={},x={},t=!1;c.dragEdges&&a.isArray(c.createDragbars)&&d(c.createDragbars);a.isArray(c.createHandles)&&v(c.createHandles);c.drawBorders&&a.isArray(c.createBorders)&&e(c.createBorders);a(document).bind("touchstart.jcrop-ios",function(b){a(b.currentTarget).hasClass("jcrop-tracker")&&b.stopPropagation()});var m=V().mousedown(Y("move")).css({cursor:"move",
position:"absolute",zIndex:360});O.support&&m.bind("touchstart.jcrop",O.createDragger("move"));l.append(m);q();return{updateVisible:g,update:w,release:function(){q();y.hide();c.shade?X.opacity(1):n(1);r=!1;c.onRelease.call(M)},refresh:f,isAwake:function(){return r},setCursor:function(a){m.css("cursor",a)},enableHandles:p,enableOnly:function(){t=!0},showHandles:function(){t&&k.show()},disableHandles:q,animMode:u,setBgOpacity:n,done:function(){u(!1);f()}}}(),P=function(){function b(a){f(x(a));return!1}
function d(b){b.preventDefault();b.stopPropagation();Z&&(Z=!1,g(x(b)),u.isAwake()&&c.onSelect.call(M,J(z.getFixed())),R.css({zIndex:290}),a(document).unbind(".jcrop"),f=function(){},g=function(){});return!1}function l(a){f(x(O.cfilter(a)));return!1}function k(a){return d(O.cfilter(a))}var f=function(){},g=function(){},y=c.trackDocument;y||R.mousemove(b).mouseup(d).mouseout(d);s.before(R);return{activateHandlers:function(c,e,v){Z=!0;f=c;g=e;R.css({zIndex:450});v?a(document).bind("touchmove.jcrop",
l).bind("touchend.jcrop",k):y&&a(document).bind("mousemove.jcrop",b).bind("mouseup.jcrop",d);return!1},setCursor:function(a){R.css("cursor",a)}}}(),na=function(){function b(a){k.hide()}function d(a,b,l){c.allowMove&&(z.moveOffset([b,l]),u.updateVisible(!0));a.preventDefault();a.stopPropagation()}function l(a){if(a.ctrlKey||a.metaKey)return!0;var b=(ra=a.shiftKey?!0:!1)?10:1;switch(a.keyCode){case 37:d(a,-b,0);break;case 39:d(a,b,0);break;case 38:d(a,0,-b);break;case 40:d(a,0,b);break;case 27:c.allowSelect&&
u.release();break;case 9:return!0}return!1}var k=a('<input type="radio" />').css({position:"fixed",left:"-120px",width:"12px"}).addClass("jcrop-keymgr"),f=a("<div />").css({position:"absolute",overflow:"hidden"}).append(k);c.keySupport&&(k.keydown(l).blur(b),A||!c.fixedSupport?(k.css({position:"absolute",left:"-20px"}),f.append(k).insertBefore(s)):k.insertBefore(s));return{watchKeys:function(){c.keySupport&&(k.show(),k.focus())}}}();O.support&&R.bind("touchstart.jcrop",O.newSelection);k.hide();H(!0);
var M={setImage:function(a,b){u.release();fa();var d=new Image;d.onload=function(){var l=d.height,k=c.boxWidth,g=c.boxHeight;s.width(d.width).height(l);s.attr("src",a);N.attr("src",a);U(s,k,g);r=s.width();q=s.height();N.width(r).height(q);R.width(r+2*v).height(q+2*v);F.width(r).height(q);X.resize(r,q);ma();"function"===typeof b&&b.call(M)};d.src=a},animateTo:function(a,b){var d=a[0]/E,l=a[1]/G,k=a[2]/E,g=a[3]/G;if(!oa){var y=z.flipCoords(d,l,k,g),e=z.getFixed(),v=[e.x,e.y,e.x2,e.y2],p=c.animationDelay,
q=y[0]-v[0],h=y[1]-v[1],r=y[2]-v[2],s=y[3]-v[3],B=0,t=c.swingSpeed,d=v[0],l=v[1],k=v[2],g=v[3];u.animMode(!0);var m=function(){return function(){B+=(100-B)/t;v[0]=Math.round(d+B/100*q);v[1]=Math.round(l+B/100*h);v[2]=Math.round(k+B/100*r);v[3]=Math.round(g+B/100*s);99.8<=B&&(B=100);100>B?(ca(v),window.setTimeout(m,p)):(u.done(),u.animMode(!1),"function"===typeof b&&b.call(M))}}();window.setTimeout(m,p)}},setSelect:ba,setOptions:function(a){B(a);H()},tellSelect:function(){return J(z.getFixed())},tellScaled:function(){return z.getFixed()},
setClass:function(a){F.removeClass().addClass(c.baseClass+"-holder").addClass(a)},disable:fa,enable:ma,cancel:function(){u.done();P.activateHandlers(null,null)},release:u.release,destroy:function(){F.remove();p.show();p.css("visibility","visible");a(b).removeData("Jcrop")},focus:na.watchKeys,getBounds:function(){return[r*E,q*G]},getWidgetSize:function(){return[r,q]},getScaleFactor:function(){return[E,G]},getOptions:function(){return c},ui:{holder:F,selection:y}};aa&&F.bind("selectstart",function(){return!1});
p.data("Jcrop",M);return M};a.fn.Jcrop=function(b,e){var h;this.each(function(){if(a(this).data("Jcrop")){if("api"===b)return a(this).data("Jcrop");a(this).data("Jcrop").setOptions(b)}else"IMG"==this.tagName?a.Jcrop.Loader(this,function(){a(this).css({display:"block",visibility:"hidden"});h=a.Jcrop(this,b);a.isFunction(e)&&e.call(h)}):(a(this).css({display:"block",visibility:"hidden"}),h=a.Jcrop(this,b),a.isFunction(e)&&e.call(h))});return this};a.Jcrop.Loader=function(b,e,h){function C(){B.complete?
(x.unbind(".jcloader"),a.isFunction(e)&&e.call(B)):window.setTimeout(C,50)}var x=a(b),B=x[0];x.bind("load.jcloader",C).bind("error.jcloader",function(b){x.unbind(".jcloader");a.isFunction(h)&&h.call(B)});B.complete&&a.isFunction(e)&&(x.unbind(".jcloader"),e.call(B))};a.Jcrop.defaults={allowSelect:!0,allowMove:!0,allowResize:!0,trackDocument:!0,baseClass:"jcrop",addClass:null,bgColor:"black",bgOpacity:0.6,bgFade:!1,borderOpacity:0.4,handleOpacity:0.5,handleSize:null,aspectRatio:0,keySupport:!0,createHandles:"n s e w nw ne se sw".split(" "),
createDragbars:["n","s","e","w"],createBorders:["n","s","e","w"],drawBorders:!0,dragEdges:!0,fixedSupport:!0,touchSupport:null,shade:null,boxWidth:0,boxHeight:0,boundary:2,fadeTime:400,animationDelay:20,swingSpeed:3,minSelect:[0,0],maxSize:[0,0],minSize:[0,0],onChange:function(){},onSelect:function(){},onDblClick:function(){},onRelease:function(){}}})(jQuery);(function(a){var b,e,h={method:"GET",contentType:"json",queryParam:"q",searchDelay:300,minChars:1,propertyToSearch:"name",jsonContainer:null,hintText:"Type in a search term",noResultsText:"No results",searchingText:"Searching...",deleteText:"&times;",animateDropdown:!0,tokenLimit:null,tokenDelimiter:",",preventDuplicates:!1,tokenValue:"id",prePopulate:null,processPrePopulate:!1,idPrefix:"token-input-",resultsFormatter:function(a){return"<li>"+a[this.propertyToSearch]+"</li>"},tokenFormatter:function(a){return"<li><p>"+
a[this.propertyToSearch]+"</p></li>"},onResult:null,onAdd:null,onDelete:null,onReady:null},C={tokenList:"token-input-list",token:"token-input-token",tokenDelete:"token-input-delete-token",selectedToken:"token-input-selected-token",highlightedToken:"token-input-highlighted-token",dropdown:"token-input-dropdown",dropdownItem:"token-input-dropdown-item",dropdownItem2:"token-input-dropdown-item2",selectedDropdownItem:"token-input-selected-dropdown-item",inputToken:"token-input-input-token"};b=0;e=1;var x=
{init:function(b,e){var d=a.extend({},h,e||{});return this.each(function(){a(this).data("tokenInputObject",new a.TokenList(this,b,d))})},clear:function(){this.data("tokenInputObject").clear();return this},add:function(a){this.data("tokenInputObject").add(a);return this},remove:function(a){this.data("tokenInputObject").remove(a);return this},get:function(){return this.data("tokenInputObject").getTokens()}};a.fn.tokenInput=function(a){return x[a]?x[a].apply(this,Array.prototype.slice.call(arguments,
1)):x.init.apply(this,arguments)};a.TokenList=function(h,x,d){function la(){null!==d.tokenLimit&&c>=d.tokenLimit&&(A.hide(),L())}function da(b){var k=d.tokenFormatter(b),k=a(k).addClass(d.classes.token).insertBefore(q);a("<span>"+d.deleteText+"</span>").addClass(d.classes.tokenDelete).appendTo(k).click(function(){T(a(this).parent());p.change();return!1});var e={id:b.id};e[d.propertyToSearch]=b[d.propertyToSearch];a.data(k.get(0),"tokeninput",b);H=H.slice(0,I).concat([e]).concat(H.slice(I));I++;ea(H,
p);c+=1;null!==d.tokenLimit&&c>=d.tokenLimit&&(A.hide(),L());return k}function Y(b){var k=d.onAdd;if(0<c&&d.preventDuplicates){var e=null;r.children().each(function(){var c=a(this),d=a.data(c.get(0),"tokeninput");if(d&&d.id===b.id)return e=c,!1});if(e){U(e);q.insertAfter(e);A.focus();return}}if(null==d.tokenLimit||c<d.tokenLimit)da(b),la();A.val("");L();a.isFunction(k)&&k.call(p,b)}function U(a){a.addClass(d.classes.selectedToken);D=a.get(0);A.val("");L()}function J(a,k){a.removeClass(d.classes.selectedToken);
D=null;k===b?(q.insertBefore(a),I--):k===e?(q.insertAfter(a),I++):(q.appendTo(r),I=c);A.focus()}function T(b){var k=a.data(b.get(0),"tokeninput"),e=d.onDelete,v=b.prevAll().length;v>I&&v--;b.remove();D=null;A.focus();H=H.slice(0,v).concat(H.slice(v+1));v<I&&I--;ea(H,p);c-=1;null!==d.tokenLimit&&A.show().val("").focus();a.isFunction(e)&&e.call(p,k)}function ea(b,c){var e=a.map(b,function(a){return a[d.tokenValue]});c.val(e.join(d.tokenDelimiter))}function L(){F.hide().empty();s=null}function V(){F.css({position:"absolute",
top:a(r).offset().top+a(r).outerHeight(),left:a(r).offset().left,zindex:999}).show()}function ba(b,c){if(c&&c.length){F.empty();var e=a("<ul>").appendTo(F).mouseover(function(b){ca(a(b.target).closest("li"))}).mousedown(function(b){Y(a(b.target).closest("li").data("tokeninput"));p.change();return!1}).hide();a.each(c,function(c,k){var h=d.resultsFormatter(k),h=h.replace(RegExp("(?![^&;]+;)(?!<[^<>]*)("+k[d.propertyToSearch]+")(?![^<>]*>)(?![^&;]+;)","g"),k[d.propertyToSearch].replace(RegExp("(?![^&;]+;)(?!<[^<>]*)("+
b+")(?![^<>]*>)(?![^&;]+;)","gi"),"<b>$1</b>")),h=a(h).appendTo(e);c%2?h.addClass(d.classes.dropdownItem):h.addClass(d.classes.dropdownItem2);0===c&&ca(h);a.data(h.get(0),"tokeninput",k)});V();d.animateDropdown?e.slideDown("fast"):e.show()}else d.noResultsText&&(F.html("<p>"+d.noResultsText+"</p>"),V())}function ca(b){b&&(s&&(a(s).removeClass(d.classes.selectedDropdownItem),s=null),b.addClass(d.classes.selectedDropdownItem),s=b.get(0))}function fa(){var b=A.val().toLowerCase();b&&b.length&&(D&&J(a(D),
e),b.length>=d.minChars?(d.searchingText&&(F.html("<p>"+d.searchingText+"</p>"),V()),clearTimeout(Q),Q=setTimeout(function(){ma(b)},d.searchDelay)):L())}function ma(b){var c=b+W(),e=K.get(c);if(e)ba(b,e);else if(d.url){var e=W(),h={data:{}};-1<e.indexOf("?")?(e=e.split("?"),h.url=e[0],e=e[1].split("&"),a.each(e,function(a,b){var c=b.split("=");h.data[c[0]]=c[1]})):h.url=e;h.data[d.queryParam]=b;h.type=d.method;h.dataType=d.contentType;d.crossDomain&&(h.dataType="jsonp");h.success=function(e){a.isFunction(d.onResult)&&
(e=d.onResult.call(p,e));K.add(c,d.jsonContainer?e[d.jsonContainer]:e);A.val().toLowerCase()===b&&ba(b,d.jsonContainer?e[d.jsonContainer]:e)};a.ajax(h)}else d.local_data&&(e=a.grep(d.local_data,function(a){return-1<a[d.propertyToSearch].toLowerCase().indexOf(b.toLowerCase())}),a.isFunction(d.onResult)&&(e=d.onResult.call(p,e)),K.add(c,e),ba(b,e))}function W(){var a=d.url;"function"==typeof d.url&&(a=d.url.call());return a}"string"===a.type(x)||"function"===a.type(x)?(d.url=x,x=W(),void 0===d.crossDomain&&
(-1===x.indexOf("://")?d.crossDomain=!1:d.crossDomain=location.href.split(/\/+/g)[1]!==x.split(/\/+/g)[1])):"object"===typeof x&&(d.local_data=x);d.classes?d.classes=a.extend({},C,d.classes):d.theme?(d.classes={},a.each(C,function(a,b){d.classes[a]=b+"-"+d.theme})):d.classes=C;var H=[],c=0,K=new a.TokenList.Cache,Q,aa,A=a('<input type="text"  autocomplete="off">').css({outline:"none"}).attr("id",d.idPrefix+h.id).focus(function(){if((null===d.tokenLimit||d.tokenLimit!==c)&&d.hintText)F.html("<p>"+
d.hintText+"</p>"),V()}).blur(function(){L();a(this).val("")}).bind("keyup keydown blur update",function(){if(aa!==(aa=A.val())){var a=aa.replace(/&/g,"&amp;").replace(/\s/g," ").replace(/</g,"&lt;").replace(/>/g,"&gt;");N.html(a);A.width(N.width()+30)}}).keydown(function(c){var d,h;switch(c.keyCode){case 37:case 39:case 38:case 40:if(a(this).val())return d=null,d=40===c.keyCode||39===c.keyCode?a(s).next():a(s).prev(),d.length&&ca(d),!1;d=q.prev();h=q.next();d.length&&d.get(0)===D||h.length&&h.get(0)===
D?37===c.keyCode||38===c.keyCode?J(a(D),b):J(a(D),e):(37===c.keyCode||38===c.keyCode)&&d.length?U(a(d.get(0))):(39===c.keyCode||40===c.keyCode)&&h.length&&U(a(h.get(0)));break;case 8:d=q.prev();if(a(this).val().length)1===a(this).val().length?L():setTimeout(function(){fa()},5);else return D?(T(a(D)),p.change()):d.length&&U(a(d.get(0))),!1;break;case 9:case 13:case 108:case 188:if(s)return Y(a(s).data("tokeninput")),p.change(),!1;break;case 27:return L(),!0;default:String.fromCharCode(c.which)&&setTimeout(function(){fa()},
5)}}),p=a(h).hide().val("").focus(function(){A.focus()}).blur(function(){A.blur()}),D=null,I=0,s=null,r=a("<ul />").addClass(d.classes.tokenList).click(function(b){if((b=a(b.target).closest("li"))&&b.get(0)&&a.data(b.get(0),"tokeninput")){var c=D;D&&J(a(D),2);c===b.get(0)?J(b,2):U(b)}else D&&J(a(D),2),A.focus()}).mouseover(function(b){(b=a(b.target).closest("li"))&&D!==this&&b.addClass(d.classes.highlightedToken)}).mouseout(function(b){(b=a(b.target).closest("li"))&&D!==this&&b.removeClass(d.classes.highlightedToken)}).insertBefore(p),
q=a("<li />").addClass(d.classes.inputToken).appendTo(r).append(A),F=a("<div>").addClass(d.classes.dropdown).appendTo("body").hide(),N=a("<tester/>").insertAfter(A).css({position:"absolute",top:-9999,left:-9999,width:"auto",fontSize:A.css("fontSize"),fontFamily:A.css("fontFamily"),fontWeight:A.css("fontWeight"),letterSpacing:A.css("letterSpacing"),whiteSpace:"nowrap"});p.val("");h=d.prePopulate||p.data("pre");d.processPrePopulate&&a.isFunction(d.onResult)&&(h=d.onResult.call(p,h));h&&h.length&&a.each(h,
function(a,b){da(b);la()});a.isFunction(d.onReady)&&d.onReady.call();this.clear=function(){r.children("li").each(function(){0===a(this).children("input").length&&T(a(this))})};this.add=function(a){Y(a)};this.remove=function(b){r.children("li").each(function(){if(0===a(this).children("input").length){var c=a(this).data("tokeninput"),d=!0,e;for(e in b)if(b[e]!==c[e]){d=!1;break}d&&T(a(this))}})};this.getTokens=function(){return H}};a.TokenList.Cache=function(b){var e=a.extend({max_size:500},b),d={},
h=0;this.add=function(a,b){h>e.max_size&&(d={},h=0);d[a]||(h+=1);d[a]=b};this.get=function(a){return d[a]}}})(jQuery);$(document).on("click",".ss-link",function(){window.location.href=this.getAttribute("data-ss-link")});$(document).on("click",".header-settings-icon",function(){$(".header-settings-extended").animate({height:"toggle"})});$(document).on("click",".add-friend-button",function(){var a=this.getAttribute("data-uid");$(this).hide();$.ajax({url:"/ajax/user/send_friend_request",method:"POST",data:{id:a}}).done(function(a){})});function dateToString(a){var b=a.getDate(),e="Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec".split(" ")[a.getMonth()],h=a.getFullYear(),C=a.getHours();a=a.getMinutes();var x="AM";12<=C&&(C-=12,x="PM");0==C&&(C=12);return""+e+" "+(9>=b?"0"+b:b)+", "+h+" at "+(9>=C?"0"+C:C)+":"+(9>=a?"0"+a:a)+" "+x}
function convert_time(){$(".time-ago").each(function(){if(""==this.getAttribute("data-time"))return!0;var a=new Date(1E3*this.getAttribute("data-time")),b=Math.round((new Date-a)/1E3);0>b?(b=0-b,60>b?$(this).html("in a few seconds"):(b=Math.floor(b/60),10>b?$(this).html("in about "+b+" minutes"):$(this).html(dateToString(a)))):60>b?$(this).html("a few seconds ago"):(b=Math.floor(b/60),60>b?$(this).html("about "+b+" minute"+(1<b?"s":"")+" ago"):(b=Math.floor(b/60),24>b?$(this).html("about "+b+" hours ago"):
$(this).html(dateToString(a))))})}convert_time();var convert_time_internval=setInterval(convert_time,6E4);$(document).on("click",".page-tab",function(){var a=".page-tab-"+this.getAttribute("data-ss-tab");$(".page-tab").removeClass("is-active");$(this).addClass("is-active");$(".page-tab-component").hide();$(a).show()});$(document).on("click",".ss-photo",function(){console.log("--Expand photo")});
$(document).on("change",".ss-picture-upload",function(){var a=this;if(a.files&&a.files[0]){var b=a.files[0];if(!b.type.match(/image.*/))return!1;var e=new FileReader;e.onload=function(b){var e=$(a).parents(".ss-file-wrapper").siblings(".ss-picture-preview");b=$("<img/>").attr("src",b.target.result);e.html(b).show();b.Jcrop({aspectRatio:1,minSize:[50,50],setSelect:[100,100,50,50],onSelect:function(a){$('input[name="profile_x"]').val(a.x);$('input[name="profile_y"]').val(a.y);$('input[name="profile_w"]').val(a.w);
$('input[name="profile_h"]').val(a.h)}})};e.readAsDataURL(b)}});$(document).on("click",".thumb-up",function(){var a=$(this).children(".thumb-up-count"),b=$(this).siblings(".thumb-down").children(".thumb-down-count"),e=this.getAttribute("data-pid");$.ajax({url:"/ajax/post/save_thumb",method:"POST",data:{type:"up",id:e}}).done(function(e){0==e.result?(b.text(parseInt(b.text())-1),a.text(parseInt(a.text())+1)):1==e.result&&a.text(parseInt(a.text())+1)})});
$(document).on("click",".thumb-down",function(){var a=$(this).children(".thumb-down-count"),b=$(this).siblings(".thumb-up").children(".thumb-up-count"),e=this.getAttribute("data-pid");$.ajax({url:"/ajax/post/save_thumb",method:"POST",data:{type:"down",id:e}}).done(function(e){0==e.result?(a.text(parseInt(a.text())+1),b.text(parseInt(b.text())-1)):1==e.result&&a.text(parseInt(a.text())+1)})});$(document).on("change",'[name="user_photos[]"]',function(){var a=new FormData;for(i=0;i<this.files.length;i++)a.append("user_photos[]",this.files[i]);$.ajax({url:"/ajax/user/upload_photos",type:"POST",data:a,processData:!1,contentType:!1,dataType:"json"}).done(function(a){console.log(a)})});
$(document).on("mouseenter",".ss-photo",function(){$(this).children(".ss-photo-hover").fadeIn();$(this).children(".ss-photo-delete").fadeIn()}).on("mouseleave",".ss-photo",function(){$(this).children(".ss-photo-hover").fadeOut();$(this).children(".ss-photo-delete").fadeOut()});$(document).on("click",".ss-photo-delete",function(a){a.stopPropagation();a=this.getAttribute("data-ss-photo-id");$.ajax({url:"/ajax/user/delete_photo",type:"POST",data:{id:a}}).done(function(a){console.log(a)})});$("#right-calendar").datepicker();
$(".ss-search-anything").autocomplete({minLength:1,source:function(a,b){$.ajax({url:"/ajax/search",data:{search:a.term},dataType:"json",type:"GET",success:function(a){b(a)}})},select:function(a,b){a.preventDefault();window.location.href="/"+b.item.type.toLowerCase()+"/"+b.item.id}}).data("ui-autocomplete")._renderItem=function(a,b){var e='<a class="ss-search-result">';""!=b.profile_picture&&(e+='<div class="profile-picture ss-search-result-img"><img src="'+b.profile_picture+'" width="50" /></div>');
e+='<div class="ss-search-result-content">'+b.name+'<br /><span style="font-size: 12px;">'+b.data+"</span></div>";e+='<div class="clear"></div></a>';return $("<li>").append(e).appendTo(a)};$(".classroom-autocomplete").autocomplete({minLength:1,source:function(a,b){$.ajax({url:"/ajax/classroom/json",data:{search:a.term},dataType:"json",type:"GET",success:function(a){b(a)}})},select:function(a,b){a.preventDefault();window.location.href="/classroom/"+b.item.id}});for(i=0;i<$(".classroom-autocomplete").length;i++)$($(".classroom-autocomplete")[i]).data("ui-autocomplete")._renderItem=function(a,b){return $("<li>").append("<a>"+b.name+"</a>").appendTo(a)};
$(".group-autocomplete").autocomplete({minLength:1,source:function(a,b){$.ajax({url:"/ajax/group/json",data:{search:a.term},dataType:"json",type:"GET",success:function(a){b(a)}})},select:function(a,b){a.preventDefault();window.location.href="/group/"+b.item.id}});for(i=0;i<$(".group-autocomplete").length;i++)$($(".group-autocomplete")[i]).data("ui-autocomplete")._renderItem=function(a,b){return $("<li>").append("<a>"+b.name+"</a>").appendTo(a)};
$(".create-classroom").click(function(){window.location.href="/classroom/create?name="+encodeURIComponent($(".classroom-autocomplete").val())});$(".create-group").click(function(){window.location.href="/group/create?name="+encodeURIComponent($(".group-autocomplete").val())});$(".page-settings").on("click",".ss-delete",function(){var a=this.getAttribute("data-ss-id");$.ajax({url:"/ajax/settings/delete_education",type:"POST",data:{id:a}}).done(function(a){});$(this).parents("tr").remove()});$(".page-settings").on("click",".ss-add-education",function(){var a=$(".hide.snippet-add-education").clone().removeClass("hide"),a=$("<tr></tr>").append($("<td></td>").append(a));$(".ss-table-education").prepend(a);update_autocomplete_my_profile()});
$(".page-settings").on("change",'select[name="type[]"]',function(){var a=$(this).siblings('input[name="name[]"]');a.val("");a.removeClass("university-autocomplete");a.removeClass("highschool-autocomplete");"highschool"==this.value?a.addClass("highschool-autocomplete"):a.addClass("university-autocomplete");$(this).siblings('input[name="education_id[]"]').val("0");update_autocomplete_my_profile()});
function update_autocomplete_my_profile(){$(".highschool-autocomplete").autocomplete({minLength:1,source:function(a,b){$.ajax({url:"/ajax/highschool/json",data:{search:a.term},dataType:"json",type:"GET",success:function(a){b(a)}})},select:function(a,b){a.preventDefault();$(this).val(b.item.name);$(this).siblings('input[name="education_id[]"]').val(b.item.id)}});for(i=0;i<$(".highschool-autocomplete").length;i++)$($(".highschool-autocomplete")[i]).data("ui-autocomplete")._renderItem=function(a,b){return $("<li>").append("<a>"+
b.name+'<br /><span style="font-size: 12px;">'+b.address+"</span></a>").appendTo(a)};$(".university-autocomplete").autocomplete({minLength:1,source:function(a,b){$.ajax({url:"/ajax/university/json",data:{search:a.term},dataType:"json",type:"GET",success:function(a){b(a)}})},select:function(a,b){a.preventDefault();$(this).val(b.item.name);$(this).siblings('input[name="education_id[]"]').val(b.item.id)}});for(i=0;i<$(".university-autocomplete").length;i++)$($(".university-autocomplete")[i]).data("ui-autocomplete")._renderItem=
function(a,b){return $("<li>").append("<a>"+b.name+'<br /><span style="font-size: 12px;">'+b.address+"</span></a>").appendTo(a)};$(".major-autocomplete").autocomplete({minLength:1,source:function(a,b){$.ajax({url:"/ajax/major/json",data:{search:a.term},dataType:"json",type:"GET",success:function(a){b(a)}})},select:function(a,b){a.preventDefault();$(this).val(b.item.title);$(this).siblings('input[name="major_id[]"]').val(b.item.id)}});for(i=0;i<$(".major-autocomplete").length;i++)$($(".major-autocomplete")[i]).data("ui-autocomplete")._renderItem=
function(a,b){return $("<li>").append("<a>"+b.title+"</a>").appendTo(a)}};$(document).on("click",".join-cg",function(){var a=this.getAttribute("data-what"),a="/ajax/"+a+"/join",b=this.getAttribute("data-id");$(this).hide();$.ajax({url:a,type:"POST",data:{id:b}}).done(function(a){$("h2.count-members").text(parseInt($("h2.count-members").text())+1)})});
