(function(a){a.Jcrop=function(b,n){function e(a){return Math.round(a)+"px"}function B(c){c=a(c).offset();return[c.left,c.top]}function y(a){return[a.pageX-J[0],a.pageY-J[1]]}function K(Y){"object"!==typeof Y&&(Y={});c=a.extend(c,Y);a.each(["onChange","onSelect","onRelease","onDblClick"],function(a,Y){"function"!==typeof c[Y]&&(c[Y]=function(){})})}function qa(a,c,b){J=B(q);P.setCursor("move"===a?a:a+"-resize");if("move"===a)return P.activateHandlers(ma(c),T,b);c=z.getFixed();var l=ea(a),f=z.getCorner(ea(l));
z.setPressed(z.getCorner(l));z.setCurrent(f);P.activateHandlers(d(a,c),T,b)}function d(a,b){return function(d){if(c.aspectRatio)switch(a){case "e":d[1]=b.y+1;break;case "w":d[1]=b.y+1;break;case "n":d[0]=b.x+1;break;case "s":d[0]=b.x+1}else switch(a){case "e":d[1]=b.y2;break;case "w":d[1]=b.y2;break;case "n":d[0]=b.x2;break;case "s":d[0]=b.x2}z.setCurrent(d);v.update()}}function ma(a){var c=a;oa.watchKeys();return function(a){z.moveOffset([a[0]-c[0],a[1]-c[1]]);c=a;v.update()}}function ea(a){switch(a){case "n":return"sw";
case "s":return"nw";case "e":return"nw";case "w":return"ne";case "ne":return"sw";case "nw":return"se";case "se":return"nw";case "sw":return"ne"}}function Z(a){return function(b){if(c.disabled||"move"===a&&!c.allowMove)return!1;J=B(q);aa=!0;qa(a,y(b));b.stopPropagation();b.preventDefault();return!1}}function U(a,c,b){var d=a.width(),l=a.height();d>c&&0<c&&(d=c,l=c/a.width()*a.height());l>b&&0<b&&(l=b,d=b/a.height()*a.width());D=a.width()/d;F=a.height()/l;a.width(d).height(l)}function I(a){return{x:a.x*
D,y:a.y*F,x2:a.x2*D,y2:a.y2*F,w:a.w*D,h:a.h*F}}function T(a){a=z.getFixed();a.w>c.minSelect[0]&&a.h>c.minSelect[1]?(v.enableHandles(),v.done()):v.release();P.setCursor(c.allowSelect?"crosshair":"default")}function fa(a){if(c.disabled||!c.allowSelect)return!1;aa=!0;J=B(q);v.disableHandles();P.setCursor("crosshair");var b=y(a);z.setPressed(b);v.update();P.activateHandlers(L,T,"touch"===a.type.substring(0,5));oa.watchKeys();a.stopPropagation();a.preventDefault();return!1}function L(a){z.setCurrent(a);
v.update()}function V(){var b=a("<div></div>").addClass(c.baseClass+"-tracker");ba&&b.css({opacity:0,backgroundColor:"white"});return b}function ca(a){da([a[0]/D,a[1]/F,a[2]/D,a[3]/F]);c.onSelect.call(M,I(z.getFixed()));v.enableHandles()}function da(a){z.setPressed([a[0],a[1]]);z.setCurrent([a[2],a[3]]);v.update()}function ga(){c.disabled=!0;v.disableHandles();v.setCursor("default");P.setCursor("default")}function na(){c.disabled=!1;G()}function W(b,d,l){d=d||c.bgColor;c.bgFade&&a.fx.step.hasOwnProperty("backgroundColor")&&
c.fadeTime&&!l?b.animate({backgroundColor:d},{queue:!1,duration:c.fadeTime}):b.css("backgroundColor",d)}function G(a){c.allowResize?a?v.enableOnly():v.enableHandles():v.disableHandles();P.setCursor(c.allowSelect?"crosshair":"default");v.setCursor(c.allowMove?"move":"default");c.hasOwnProperty("trueSize")&&(D=c.trueSize[0]/t,F=c.trueSize[1]/s);c.hasOwnProperty("setSelect")&&(ca(c.setSelect),v.done(),delete c.setSelect);X.refresh();c.bgColor!=ra&&(W(c.shade?X.getShades():E,c.shade?c.shadeColor||c.bgColor:
c.bgColor),ra=c.bgColor);ha!=c.bgOpacity&&(ha=c.bgOpacity,c.shade?X.refresh():v.setBgOpacity(ha));ia=c.maxSize[0]||0;ja=c.maxSize[1]||0;ka=c.minSize[0]||0;la=c.minSize[1]||0;c.hasOwnProperty("outerImage")&&(q.attr("src",c.outerImage),delete c.outerImage);v.refresh()}var c=a.extend({},a.Jcrop.defaults),J,Q=navigator.userAgent.toLowerCase(),ba=/msie/.test(Q),A=/msie [1-6]\./.test(Q);"object"!==typeof b&&(b=a(b)[0]);"object"!==typeof n&&(n={});K(n);var Q={border:"none",visibility:"visible",margin:0,
padding:0,position:"absolute",top:0,left:0},r=a(b),C=!0;if("IMG"==b.tagName){if(0!=r[0].width&&0!=r[0].height)r.width(r[0].width),r.height(r[0].height);else{var H=new Image;H.src=r[0].src;r.width(H.width);r.height(H.height)}var q=r.clone().removeAttr("id").css(Q).show();q.width(r.width());q.height(r.height());r.after(q).hide()}else q=r.css(Q).show(),C=!1,null===c.shade&&(c.shade=!0);U(q,c.boxWidth,c.boxHeight);var t=q.width(),s=q.height(),E=a("<div />").width(t).height(s).addClass(c.baseClass+"-holder").css({position:"relative",
backgroundColor:c.bgColor}).insertAfter(r).append(q);c.addClass&&E.addClass(c.addClass);var N=a("<div />"),l=a("<div />").width("100%").height("100%").css({zIndex:310,position:"absolute",overflow:"hidden"}),h=a("<div />").width("100%").height("100%").css("zIndex",320),k=a("<div />").css({position:"absolute",zIndex:600}).dblclick(function(){var a=z.getFixed();c.onDblClick.call(M,a)}).insertBefore(q).append(l,h);C&&(N=a("<img />").attr("src",q.attr("src")).css(Q).width(t).height(s),l.append(N));A&&
k.css({overflowY:"hidden"});var w=c.boundary,R=V().width(t+2*w).height(s+2*w).css({position:"absolute",top:e(-w),left:e(-w),zIndex:290}).mousedown(fa),ra=c.bgColor,ha=c.bgOpacity,ia,ja,ka,la,D,F,aa,pa,sa;J=B(q);var O=function(){function a(){var c={},b=["touchstart","touchmove","touchend"],d=document.createElement("div"),l;try{for(l=0;l<b.length;l++){var x=b[l],x="on"+x,m=x in d;m||(d.setAttribute(x,"return;"),m="function"==typeof d[x]);c[b[l]]=m}return c.touchstart&&c.touchend&&c.touchmove}catch(h){return!1}}
var b;b=!0===c.touchSupport||!1===c.touchSupport?c.touchSupport:a();return{createDragger:function(a){return function(b){if(c.disabled||"move"===a&&!c.allowMove)return!1;J=B(q);aa=!0;qa(a,y(O.cfilter(b)),!0);b.stopPropagation();b.preventDefault();return!1}},newSelection:function(a){return fa(O.cfilter(a))},cfilter:function(a){a.pageX=a.originalEvent.changedTouches[0].pageX;a.pageY=a.originalEvent.changedTouches[0].pageY;return a},isSupported:a,support:b}}(),z=function(){function a(){if(!c.aspectRatio){var b=
x-f,S=m-g;ia&&Math.abs(b)>ia&&(x=0<b?f+ia:f-ia);ja&&Math.abs(S)>ja&&(m=0<S?g+ja:g-ja);la/F&&Math.abs(S)<la/F&&(m=0<S?g+la/F:g-la/F);ka/D&&Math.abs(b)<ka/D&&(x=0<b?f+ka/D:f-ka/D);0>f&&(x-=f,f-=f);0>g&&(m-=g,g-=g);0>x&&(f-=x,x-=x);0>m&&(g-=m,m-=m);x>t&&(b=x-t,f-=b,x-=b);m>s&&(b=m-s,g-=b,m-=b);f>t&&(b=f-s,m-=b,g-=b);g>s&&(b=g-s,m-=b,g-=b);return l(d(f,g,x,m))}var b=c.aspectRatio,S=c.minSize[0]/D,h=c.maxSize[0]/D,k=x-f,e=m-g,u=Math.abs(k),p=Math.abs(e);0===h&&(h=10*t);u/p<b?(u=m,p*=b,p=0>k?f-p:p+f,0>
p?(p=0,u=Math.abs((p-f)/b),u=0>e?g-u:u+g):p>t&&(p=t,u=Math.abs((p-f)/b),u=0>e?g-u:u+g)):(p=x,u/=b,u=0>e?g-u:g+u,0>u?(u=0,p=Math.abs((u-g)*b),p=0>k?f-p:p+f):u>s&&(u=s,p=Math.abs(u-g)*b,p=0>k?f-p:p+f));p>f?(p-f<S?p=f+S:p-f>h&&(p=f+h),u=u>g?g+(p-f)/b:g-(p-f)/b):p<f&&(f-p<S?p=f-S:f-p>h&&(p=f-h),u=u>g?g+(f-p)/b:g-(f-p)/b);0>p?(f-=p,p=0):p>t&&(f-=p-t,p=t);0>u?(g-=u,u=0):u>s&&(g-=u-s,u=s);return l(d(f,g,p,u))}function b(a){0>a[0]&&(a[0]=0);0>a[1]&&(a[1]=0);a[0]>t&&(a[0]=t);a[1]>s&&(a[1]=s);return[Math.round(a[0]),
Math.round(a[1])]}function d(a,b,c,l){var g=a,f=c,h=b,m=l;c<a&&(g=c,f=a);l<b&&(h=l,m=b);return[g,h,f,m]}function l(a){return{x:a[0],y:a[1],x2:a[2],y2:a[3],w:a[2]-a[0],h:a[3]-a[1]}}var f=0,g=0,x=0,m=0,h,k;return{flipCoords:d,setPressed:function(a){a=b(a);x=f=a[0];m=g=a[1]},setCurrent:function(a){a=b(a);h=a[0]-x;k=a[1]-m;x=a[0];m=a[1]},getOffset:function(){return[h,k]},moveOffset:function(a){var b=a[0];a=a[1];0>f+b&&(b-=b+f);0>g+a&&(a-=a+g);s<m+a&&(a+=s-(m+a));t<x+b&&(b+=t-(x+b));f+=b;x+=b;g+=a;m+=
a},getCorner:function(b){var c=a();switch(b){case "ne":return[c.x2,c.y];case "nw":return[c.x,c.y];case "se":return[c.x2,c.y2];case "sw":return[c.x,c.y2]}},getFixed:a}}(),X=function(){function b(){return d(z.getFixed())}function d(a){r.top.css({left:e(a.x),width:e(a.w),height:e(a.y)});r.bottom.css({top:e(a.y2),left:e(a.x),width:e(a.w),height:e(s-a.y2)});r.right.css({left:e(a.x2),width:e(t-a.x2)});r.left.css({width:e(a.x)})}function l(){return a("<div />").css({position:"absolute",backgroundColor:c.shadeColor||
c.bgColor}).appendTo(w)}function h(){n||(n=!0,w.insertBefore(q),b(),v.setBgOpacity(1,0,1),N.hide(),f(c.shadeColor||c.bgColor,1),v.isAwake()?k(c.bgOpacity,1):k(1,1))}function f(a,b){W(m(),a,b)}function g(){n&&(w.remove(),N.show(),n=!1,v.isAwake()?v.setBgOpacity(c.bgOpacity,1,1):(v.setBgOpacity(1,1,1),v.disableHandles()),W(E,0,1))}function k(a,b){n&&(c.bgFade&&!b?w.animate({opacity:1-a},{queue:!1,duration:c.fadeTime}):w.css({opacity:1-a}))}function m(){return w.children()}var n=!1,w=a("<div />").css({position:"absolute",
zIndex:240,opacity:0}),r={top:l(),left:l().height(s),right:l().height(s),bottom:l()};return{update:b,updateRaw:d,getShades:m,setBgColor:f,enable:h,disable:g,resize:function(a,b){r.left.css({height:e(b)});r.right.css({height:e(b)})},refresh:function(){c.shade?h():g();v.isAwake()&&k(c.bgOpacity)},opacity:k}}(),v=function(){function b(c,d){var l=a("<div />").mousedown(Z(c)).css({cursor:c+"-resize",position:"absolute",zIndex:d}).addClass("ord-"+c);O.support&&l.bind("touchstart.jcrop",O.createDragger(c));
h.append(l);return l}function d(a){var c;for(c=0;c<a.length;c++)b(a[c],K++).addClass("jcrop-dragbar")}function w(b){var d,g;for(g=0;g<b.length;g++){switch(b[g]){case "n":d="hline";break;case "s":d="hline bottom";break;case "e":d="vline right";break;case "w":d="vline"}var f=R,h=b[g],m=d,m=a("<div />").css({position:"absolute",opacity:c.borderOpacity}).addClass(c.baseClass+"-"+m);l.append(m);f[h]=m}}function n(a){var d;for(d=0;d<a.length;d++){var l=y,g=a[d],f=c.handleSize,h=b(a[d],K++).css({opacity:c.handleOpacity}).addClass(c.baseClass+
"-handle");f&&h.width(f).height(f);l[g]=h}}function f(){var a=z.getFixed();z.setPressed([a.x,a.y]);z.setCurrent([a.x2,a.y2]);g()}function g(a){if(t)return x(a)}function x(a){var b=z.getFixed(),d=b.h;k.width(Math.round(b.w)).height(Math.round(d));var d=b.x,l=b.y;c.shade||N.css({top:e(-l),left:e(-d)});k.css({top:e(l),left:e(d)});c.shade&&X.updateRaw(b);t||(k.show(),c.shade?X.opacity(ha):m(ha,!0),t=!0);a?c.onSelect.call(M,I(b)):c.onChange.call(M,I(b))}function m(a,b,d){if(t||b)c.bgFade&&!d?q.animate({opacity:a},
{queue:!1,duration:c.fadeTime}):q.css("opacity",a)}function r(){u=!0;if(c.allowResize)return h.show(),!0}function s(){u=!1;h.hide()}function v(a){a?(pa=!0,s()):(pa=!1,r())}var t,K=370,R={},y={},u=!1;c.dragEdges&&a.isArray(c.createDragbars)&&d(c.createDragbars);a.isArray(c.createHandles)&&n(c.createHandles);c.drawBorders&&a.isArray(c.createBorders)&&w(c.createBorders);a(document).bind("touchstart.jcrop-ios",function(b){a(b.currentTarget).hasClass("jcrop-tracker")&&b.stopPropagation()});var p=V().mousedown(Z("move")).css({cursor:"move",
position:"absolute",zIndex:360});O.support&&p.bind("touchstart.jcrop",O.createDragger("move"));l.append(p);s();return{updateVisible:g,update:x,release:function(){s();k.hide();c.shade?X.opacity(1):m(1);t=!1;c.onRelease.call(M)},refresh:f,isAwake:function(){return t},setCursor:function(a){p.css("cursor",a)},enableHandles:r,enableOnly:function(){u=!0},showHandles:function(){u&&h.show()},disableHandles:s,animMode:v,setBgOpacity:m,done:function(){v(!1);f()}}}(),P=function(){function b(a){f(y(a));return!1}
function d(b){b.preventDefault();b.stopPropagation();aa&&(aa=!1,g(y(b)),v.isAwake()&&c.onSelect.call(M,I(z.getFixed())),R.css({zIndex:290}),a(document).unbind(".jcrop"),f=function(){},g=function(){});return!1}function l(a){f(y(O.cfilter(a)));return!1}function h(a){return d(O.cfilter(a))}var f=function(){},g=function(){},k=c.trackDocument;k||R.mousemove(b).mouseup(d).mouseout(d);q.before(R);return{activateHandlers:function(c,w,n){aa=!0;f=c;g=w;R.css({zIndex:450});n?a(document).bind("touchmove.jcrop",
l).bind("touchend.jcrop",h):k&&a(document).bind("mousemove.jcrop",b).bind("mouseup.jcrop",d);return!1},setCursor:function(a){R.css("cursor",a)}}}(),oa=function(){function b(a){h.hide()}function d(a,b,l){c.allowMove&&(z.moveOffset([b,l]),v.updateVisible(!0));a.preventDefault();a.stopPropagation()}function l(a){if(a.ctrlKey||a.metaKey)return!0;var b=(sa=a.shiftKey?!0:!1)?10:1;switch(a.keyCode){case 37:d(a,-b,0);break;case 39:d(a,b,0);break;case 38:d(a,0,-b);break;case 40:d(a,0,b);break;case 27:c.allowSelect&&
v.release();break;case 9:return!0}return!1}var h=a('<input type="radio" />').css({position:"fixed",left:"-120px",width:"12px"}).addClass("jcrop-keymgr"),f=a("<div />").css({position:"absolute",overflow:"hidden"}).append(h);c.keySupport&&(h.keydown(l).blur(b),A||!c.fixedSupport?(h.css({position:"absolute",left:"-20px"}),f.append(h).insertBefore(q)):h.insertBefore(q));return{watchKeys:function(){c.keySupport&&(h.show(),h.focus())}}}();O.support&&R.bind("touchstart.jcrop",O.newSelection);h.hide();G(!0);
var M={setImage:function(a,b){v.release();ga();var d=new Image;d.onload=function(){var l=d.height,h=c.boxWidth,g=c.boxHeight;q.width(d.width).height(l);q.attr("src",a);N.attr("src",a);U(q,h,g);t=q.width();s=q.height();N.width(t).height(s);R.width(t+2*w).height(s+2*w);E.width(t).height(s);X.resize(t,s);na();"function"===typeof b&&b.call(M)};d.src=a},animateTo:function(a,b){var d=a[0]/D,l=a[1]/F,h=a[2]/D,g=a[3]/F;if(!pa){var k=z.flipCoords(d,l,h,g),m=z.getFixed(),w=[m.x,m.y,m.x2,m.y2],n=c.animationDelay,
e=k[0]-w[0],r=k[1]-w[1],s=k[2]-w[2],t=k[3]-w[3],q=0,u=c.swingSpeed,d=w[0],l=w[1],h=w[2],g=w[3];v.animMode(!0);var p=function(){return function(){q+=(100-q)/u;w[0]=Math.round(d+q/100*e);w[1]=Math.round(l+q/100*r);w[2]=Math.round(h+q/100*s);w[3]=Math.round(g+q/100*t);99.8<=q&&(q=100);100>q?(da(w),window.setTimeout(p,n)):(v.done(),v.animMode(!1),"function"===typeof b&&b.call(M))}}();window.setTimeout(p,n)}},setSelect:ca,setOptions:function(a){K(a);G()},tellSelect:function(){return I(z.getFixed())},tellScaled:function(){return z.getFixed()},
setClass:function(a){E.removeClass().addClass(c.baseClass+"-holder").addClass(a)},disable:ga,enable:na,cancel:function(){v.done();P.activateHandlers(null,null)},release:v.release,destroy:function(){E.remove();r.show();r.css("visibility","visible");a(b).removeData("Jcrop")},focus:oa.watchKeys,getBounds:function(){return[t*D,s*F]},getWidgetSize:function(){return[t,s]},getScaleFactor:function(){return[D,F]},getOptions:function(){return c},ui:{holder:E,selection:k}};ba&&E.bind("selectstart",function(){return!1});
r.data("Jcrop",M);return M};a.fn.Jcrop=function(b,n){var e;this.each(function(){if(a(this).data("Jcrop")){if("api"===b)return a(this).data("Jcrop");a(this).data("Jcrop").setOptions(b)}else"IMG"==this.tagName?a.Jcrop.Loader(this,function(){a(this).css({display:"block",visibility:"hidden"});e=a.Jcrop(this,b);a.isFunction(n)&&n.call(e)}):(a(this).css({display:"block",visibility:"hidden"}),e=a.Jcrop(this,b),a.isFunction(n)&&n.call(e))});return this};a.Jcrop.Loader=function(b,n,e){function B(){K.complete?
(y.unbind(".jcloader"),a.isFunction(n)&&n.call(K)):window.setTimeout(B,50)}var y=a(b),K=y[0];y.bind("load.jcloader",B).bind("error.jcloader",function(b){y.unbind(".jcloader");a.isFunction(e)&&e.call(K)});K.complete&&a.isFunction(n)&&(y.unbind(".jcloader"),n.call(K))};a.Jcrop.defaults={allowSelect:!0,allowMove:!0,allowResize:!0,trackDocument:!0,baseClass:"jcrop",addClass:null,bgColor:"black",bgOpacity:0.6,bgFade:!1,borderOpacity:0.4,handleOpacity:0.5,handleSize:null,aspectRatio:0,keySupport:!0,createHandles:"n s e w nw ne se sw".split(" "),
createDragbars:["n","s","e","w"],createBorders:["n","s","e","w"],drawBorders:!0,dragEdges:!0,fixedSupport:!0,touchSupport:null,shade:null,boxWidth:0,boxHeight:0,boundary:2,fadeTime:400,animationDelay:20,swingSpeed:3,minSelect:[0,0],maxSize:[0,0],minSize:[0,0],onChange:function(){},onSelect:function(){},onDblClick:function(){},onRelease:function(){}}})(jQuery);(function(a){var b,n,e={method:"GET",contentType:"json",queryParam:"q",searchDelay:300,minChars:1,propertyToSearch:"name",jsonContainer:null,hintText:"Type in a search term",noResultsText:"No results",searchingText:"Searching...",deleteText:"&times;",animateDropdown:!0,tokenLimit:null,tokenDelimiter:",",preventDuplicates:!1,tokenValue:"id",prePopulate:null,processPrePopulate:!1,idPrefix:"token-input-",resultsFormatter:function(a){return"<li>"+a[this.propertyToSearch]+"</li>"},tokenFormatter:function(a){return"<li><p>"+
a[this.propertyToSearch]+"</p></li>"},onResult:null,onAdd:null,onDelete:null,onReady:null},B={tokenList:"token-input-list",token:"token-input-token",tokenDelete:"token-input-delete-token",selectedToken:"token-input-selected-token",highlightedToken:"token-input-highlighted-token",dropdown:"token-input-dropdown",dropdownItem:"token-input-dropdown-item",dropdownItem2:"token-input-dropdown-item2",selectedDropdownItem:"token-input-selected-dropdown-item",inputToken:"token-input-input-token"};b=0;n=1;var y=
{init:function(b,n){var d=a.extend({},e,n||{});return this.each(function(){a(this).data("tokenInputObject",new a.TokenList(this,b,d))})},clear:function(){this.data("tokenInputObject").clear();return this},add:function(a){this.data("tokenInputObject").add(a);return this},remove:function(a){this.data("tokenInputObject").remove(a);return this},get:function(){return this.data("tokenInputObject").getTokens()}};a.fn.tokenInput=function(a){return y[a]?y[a].apply(this,Array.prototype.slice.call(arguments,
1)):y.init.apply(this,arguments)};a.TokenList=function(e,y,d){function ma(){null!==d.tokenLimit&&c>=d.tokenLimit&&(A.hide(),L())}function ea(b){var h=d.tokenFormatter(b),h=a(h).addClass(d.classes.token).insertBefore(s);a("<span>"+d.deleteText+"</span>").addClass(d.classes.tokenDelete).appendTo(h).click(function(){T(a(this).parent());r.change();return!1});var k={id:b.id};k[d.propertyToSearch]=b[d.propertyToSearch];a.data(h.get(0),"tokeninput",b);G=G.slice(0,H).concat([k]).concat(G.slice(H));H++;fa(G,
r);c+=1;null!==d.tokenLimit&&c>=d.tokenLimit&&(A.hide(),L());return h}function Z(b){var h=d.onAdd;if(0<c&&d.preventDuplicates){var k=null;t.children().each(function(){var c=a(this),d=a.data(c.get(0),"tokeninput");if(d&&d.id===b.id)return k=c,!1});if(k){U(k);s.insertAfter(k);A.focus();return}}if(null==d.tokenLimit||c<d.tokenLimit)ea(b),ma();A.val("");L();a.isFunction(h)&&h.call(r,b)}function U(a){a.addClass(d.classes.selectedToken);C=a.get(0);A.val("");L()}function I(a,h){a.removeClass(d.classes.selectedToken);
C=null;h===b?(s.insertBefore(a),H--):h===n?(s.insertAfter(a),H++):(s.appendTo(t),H=c);A.focus()}function T(b){var h=a.data(b.get(0),"tokeninput"),k=d.onDelete,w=b.prevAll().length;w>H&&w--;b.remove();C=null;A.focus();G=G.slice(0,w).concat(G.slice(w+1));w<H&&H--;fa(G,r);c-=1;null!==d.tokenLimit&&A.show().val("").focus();a.isFunction(k)&&k.call(r,h)}function fa(b,c){var k=a.map(b,function(a){return a[d.tokenValue]});c.val(k.join(d.tokenDelimiter))}function L(){E.hide().empty();q=null}function V(){E.css({position:"absolute",
top:a(t).offset().top+a(t).outerHeight(),left:a(t).offset().left,zindex:999}).show()}function ca(b,c){if(c&&c.length){E.empty();var k=a("<ul>").appendTo(E).mouseover(function(b){da(a(b.target).closest("li"))}).mousedown(function(b){Z(a(b.target).closest("li").data("tokeninput"));r.change();return!1}).hide();a.each(c,function(c,h){var e=d.resultsFormatter(h),e=e.replace(RegExp("(?![^&;]+;)(?!<[^<>]*)("+h[d.propertyToSearch]+")(?![^<>]*>)(?![^&;]+;)","g"),h[d.propertyToSearch].replace(RegExp("(?![^&;]+;)(?!<[^<>]*)("+
b+")(?![^<>]*>)(?![^&;]+;)","gi"),"<b>$1</b>")),e=a(e).appendTo(k);c%2?e.addClass(d.classes.dropdownItem):e.addClass(d.classes.dropdownItem2);0===c&&da(e);a.data(e.get(0),"tokeninput",h)});V();d.animateDropdown?k.slideDown("fast"):k.show()}else d.noResultsText&&(E.html("<p>"+d.noResultsText+"</p>"),V())}function da(b){b&&(q&&(a(q).removeClass(d.classes.selectedDropdownItem),q=null),b.addClass(d.classes.selectedDropdownItem),q=b.get(0))}function ga(){var b=A.val().toLowerCase();b&&b.length&&(C&&I(a(C),
n),b.length>=d.minChars?(d.searchingText&&(E.html("<p>"+d.searchingText+"</p>"),V()),clearTimeout(Q),Q=setTimeout(function(){na(b)},d.searchDelay)):L())}function na(b){var c=b+W(),k=J.get(c);if(k)ca(b,k);else if(d.url){var k=W(),e={data:{}};-1<k.indexOf("?")?(k=k.split("?"),e.url=k[0],k=k[1].split("&"),a.each(k,function(a,b){var c=b.split("=");e.data[c[0]]=c[1]})):e.url=k;e.data[d.queryParam]=b;e.type=d.method;e.dataType=d.contentType;d.crossDomain&&(e.dataType="jsonp");e.success=function(e){a.isFunction(d.onResult)&&
(e=d.onResult.call(r,e));J.add(c,d.jsonContainer?e[d.jsonContainer]:e);A.val().toLowerCase()===b&&ca(b,d.jsonContainer?e[d.jsonContainer]:e)};a.ajax(e)}else d.local_data&&(k=a.grep(d.local_data,function(a){return-1<a[d.propertyToSearch].toLowerCase().indexOf(b.toLowerCase())}),a.isFunction(d.onResult)&&(k=d.onResult.call(r,k)),J.add(c,k),ca(b,k))}function W(){var a=d.url;"function"==typeof d.url&&(a=d.url.call());return a}"string"===a.type(y)||"function"===a.type(y)?(d.url=y,y=W(),void 0===d.crossDomain&&
(-1===y.indexOf("://")?d.crossDomain=!1:d.crossDomain=location.href.split(/\/+/g)[1]!==y.split(/\/+/g)[1])):"object"===typeof y&&(d.local_data=y);d.classes?d.classes=a.extend({},B,d.classes):d.theme?(d.classes={},a.each(B,function(a,b){d.classes[a]=b+"-"+d.theme})):d.classes=B;var G=[],c=0,J=new a.TokenList.Cache,Q,ba,A=a('<input type="text"  autocomplete="off">').css({outline:"none"}).attr("id",d.idPrefix+e.id).focus(function(){if((null===d.tokenLimit||d.tokenLimit!==c)&&d.hintText)E.html("<p>"+
d.hintText+"</p>"),V()}).blur(function(){L();a(this).val("")}).bind("keyup keydown blur update",function(){if(ba!==(ba=A.val())){var a=ba.replace(/&/g,"&amp;").replace(/\s/g," ").replace(/</g,"&lt;").replace(/>/g,"&gt;");N.html(a);A.width(N.width()+30)}}).keydown(function(c){var d,e;switch(c.keyCode){case 37:case 39:case 38:case 40:if(a(this).val())return d=null,d=40===c.keyCode||39===c.keyCode?a(q).next():a(q).prev(),d.length&&da(d),!1;d=s.prev();e=s.next();d.length&&d.get(0)===C||e.length&&e.get(0)===
C?37===c.keyCode||38===c.keyCode?I(a(C),b):I(a(C),n):(37===c.keyCode||38===c.keyCode)&&d.length?U(a(d.get(0))):(39===c.keyCode||40===c.keyCode)&&e.length&&U(a(e.get(0)));break;case 8:d=s.prev();if(a(this).val().length)1===a(this).val().length?L():setTimeout(function(){ga()},5);else return C?(T(a(C)),r.change()):d.length&&U(a(d.get(0))),!1;break;case 9:case 13:case 108:case 188:if(q)return Z(a(q).data("tokeninput")),r.change(),!1;break;case 27:return L(),!0;default:String.fromCharCode(c.which)&&setTimeout(function(){ga()},
5)}}),r=a(e).hide().val("").focus(function(){A.focus()}).blur(function(){A.blur()}),C=null,H=0,q=null,t=a("<ul />").addClass(d.classes.tokenList).click(function(b){if((b=a(b.target).closest("li"))&&b.get(0)&&a.data(b.get(0),"tokeninput")){var c=C;C&&I(a(C),2);c===b.get(0)?I(b,2):U(b)}else C&&I(a(C),2),A.focus()}).mouseover(function(b){(b=a(b.target).closest("li"))&&C!==this&&b.addClass(d.classes.highlightedToken)}).mouseout(function(b){(b=a(b.target).closest("li"))&&C!==this&&b.removeClass(d.classes.highlightedToken)}).insertBefore(r),
s=a("<li />").addClass(d.classes.inputToken).appendTo(t).append(A),E=a("<div>").addClass(d.classes.dropdown).appendTo("body").hide(),N=a("<tester/>").insertAfter(A).css({position:"absolute",top:-9999,left:-9999,width:"auto",fontSize:A.css("fontSize"),fontFamily:A.css("fontFamily"),fontWeight:A.css("fontWeight"),letterSpacing:A.css("letterSpacing"),whiteSpace:"nowrap"});r.val("");e=d.prePopulate||r.data("pre");d.processPrePopulate&&a.isFunction(d.onResult)&&(e=d.onResult.call(r,e));e&&e.length&&a.each(e,
function(a,b){ea(b);ma()});a.isFunction(d.onReady)&&d.onReady.call();this.clear=function(){t.children("li").each(function(){0===a(this).children("input").length&&T(a(this))})};this.add=function(a){Z(a)};this.remove=function(b){t.children("li").each(function(){if(0===a(this).children("input").length){var c=a(this).data("tokeninput"),d=!0,e;for(e in b)if(b[e]!==c[e]){d=!1;break}d&&T(a(this))}})};this.getTokens=function(){return G}};a.TokenList.Cache=function(b){var e=a.extend({max_size:500},b),d={},
n=0;this.add=function(a,b){n>e.max_size&&(d={},n=0);d[a]||(n+=1);d[a]=b};this.get=function(a){return d[a]}}})(jQuery);$(document).on("click",".ss-link",function(){window.location.href=this.getAttribute("data-ss-link")});$(document).on("click",".header-settings-icon",function(){$(".header-settings-extended").animate({height:"toggle"})});$(document).on("click",".add-friend-button",function(){var a=this.getAttribute("data-uid");$(this).hide();$.ajax({url:"/ajax/user/send_friend_request",method:"POST",data:{id:a}}).done(function(a){})});function dateToString(a){var b=a.getDate(),n="Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec".split(" ")[a.getMonth()],e=a.getFullYear(),B=a.getHours();a=a.getMinutes();var y="AM";12<=B&&(B-=12,y="PM");0==B&&(B=12);return""+n+" "+(9>=b?"0"+b:b)+", "+e+" at "+(9>=B?"0"+B:B)+":"+(9>=a?"0"+a:a)+" "+y}
function convert_time(){$(".time-ago").each(function(){if(""==this.getAttribute("data-time"))return!0;var a=new Date(1E3*this.getAttribute("data-time")),b=Math.round((new Date-a)/1E3);0>b?(b=0-b,60>b?$(this).html("in a few seconds"):(b=Math.floor(b/60),10>b?$(this).html("in about "+b+" minutes"):$(this).html(dateToString(a)))):60>b?$(this).html("a few seconds ago"):(b=Math.floor(b/60),60>b?$(this).html("about "+b+" minute"+(1<b?"s":"")+" ago"):(b=Math.floor(b/60),24>b?$(this).html("about "+b+" hours ago"):
$(this).html(dateToString(a))))})}convert_time();var convert_time_internval=setInterval(convert_time,6E4);$(document).on("click",".page-tab",function(){var a=".page-tab-"+this.getAttribute("data-ss-tab");$(".page-tab").removeClass("is-active");$(this).addClass("is-active");$(".page-tab-component").hide();$(a).show()});$(document).on("click",".ss-photo",function(){console.log("--Expand photo")});
$(document).on("change",".ss-picture-upload",function(){var a=this;if(a.files&&a.files[0]){var b=a.files[0];if(!b.type.match(/image.*/))return!1;var n=new FileReader;n.onload=function(b){var n=$(a).parents(".ss-file-wrapper").siblings(".ss-picture-preview");b=$("<img/>").attr("src",b.target.result);n.html(b).show();b.Jcrop({aspectRatio:1,minSize:[50,50],setSelect:[100,100,50,50],onSelect:function(a){$('input[name="profile_x"]').val(a.x);$('input[name="profile_y"]').val(a.y);$('input[name="profile_w"]').val(a.w);
$('input[name="profile_h"]').val(a.h)}})};n.readAsDataURL(b)}});$(document).on("click",".thumb-up",function(){var a=$(this).children(".thumb-up-count"),b=$(this).siblings(".thumb-down").children(".thumb-down-count"),n=this.getAttribute("data-pid");$.ajax({url:"/ajax/post/save_thumb",method:"POST",data:{type:"up",id:n}}).done(function(e){0==e.result?(b.text(parseInt(b.text())-1),a.text(parseInt(a.text())+1)):1==e.result&&a.text(parseInt(a.text())+1)})});
$(document).on("click",".thumb-down",function(){var a=$(this).children(".thumb-down-count"),b=$(this).siblings(".thumb-up").children(".thumb-up-count"),n=this.getAttribute("data-pid");$.ajax({url:"/ajax/post/save_thumb",method:"POST",data:{type:"down",id:n}}).done(function(e){0==e.result?(a.text(parseInt(a.text())+1),b.text(parseInt(b.text())-1)):1==e.result&&a.text(parseInt(a.text())+1)})});$(document).on("change",'[name="user_photos[]"]',function(){var a=new FormData;for(i=0;i<this.files.length;i++)a.append("user_photos[]",this.files[i]);$.ajax({url:"/ajax/user/upload_photos",type:"POST",data:a,processData:!1,contentType:!1,dataType:"json"}).done(function(a){console.log(a)})});
$(document).on("mouseenter",".ss-photo",function(){$(this).children(".ss-photo-hover").fadeIn();$(this).children(".ss-photo-delete").fadeIn()}).on("mouseleave",".ss-photo",function(){$(this).children(".ss-photo-hover").fadeOut();$(this).children(".ss-photo-delete").fadeOut()});$(document).on("click",".ss-photo-delete",function(a){a.stopPropagation();a=this.getAttribute("data-ss-photo-id");$.ajax({url:"/ajax/user/delete_photo",type:"POST",data:{id:a}}).done(function(a){console.log(a)})});$("#right-calendar").datepicker();$(".classroom-autocomplete").autocomplete({minLength:1,source:function(a,b){$.ajax({url:"/ajax/classroom/json",data:{search:a.term},dataType:"json",type:"GET",success:function(a){b(a)}})},select:function(a,b){a.preventDefault();window.location.href="/classroom/"+b.item.id}});for(i=0;i<$(".classroom-autocomplete").length;i++)$($(".classroom-autocomplete")[i]).data("ui-autocomplete")._renderItem=function(a,b){return $("<li>").append("<a>"+b.name+"</a>").appendTo(a)};
$(".group-autocomplete").autocomplete({minLength:1,source:function(a,b){$.ajax({url:"/ajax/group/json",data:{search:a.term},dataType:"json",type:"GET",success:function(a){b(a)}})},select:function(a,b){a.preventDefault();window.location.href="/group/"+b.item.id}});for(i=0;i<$(".group-autocomplete").length;i++)$($(".group-autocomplete")[i]).data("ui-autocomplete")._renderItem=function(a,b){return $("<li>").append("<a>"+b.name+"</a>").appendTo(a)};
$(".create-classroom").click(function(){window.location.href="/classroom/create?name="+encodeURIComponent($(".classroom-autocomplete").val())});$(".create-group").click(function(){window.location.href="/group/create?name="+encodeURIComponent($(".group-autocomplete").val())});$(".page-settings").on("click",".ss-delete",function(){var a=this.getAttribute("data-ss-id");$.ajax({url:"/ajax/settings/delete_education",type:"POST",data:{id:a}}).done(function(a){});$(this).parents("tr").remove()});$(".page-settings").on("click",".ss-add-education",function(){var a=$(".hide.snippet-add-education").clone().removeClass("hide"),a=$("<tr></tr>").append($("<td></td>").append(a));$(".ss-table-education").prepend(a);update_autocomplete_my_profile()});
$(".page-settings").on("change",'select[name="type[]"]',function(){var a=$(this).siblings('input[name="name[]"]');a.val("");a.removeClass("university-autocomplete");a.removeClass("highschool-autocomplete");"highschool"==this.value?a.addClass("highschool-autocomplete"):a.addClass("university-autocomplete");$(this).siblings('input[name="education_id[]"]').val("0");update_autocomplete_my_profile()});
function update_autocomplete_my_profile(){$(".highschool-autocomplete").autocomplete({minLength:1,source:function(a,b){$.ajax({url:"/ajax/highschool/json",data:{search:a.term},dataType:"json",type:"GET",success:function(a){b(a)}})},select:function(a,b){a.preventDefault();$(this).val(b.item.name);$(this).siblings('input[name="education_id[]"]').val(b.item.id)}});for(i=0;i<$(".highschool-autocomplete").length;i++)$($(".highschool-autocomplete")[i]).data("ui-autocomplete")._renderItem=function(a,b){return $("<li>").append("<a>"+
b.name+'<br /><span style="font-size: 12px;">'+b.address+"</span></a>").appendTo(a)};$(".university-autocomplete").autocomplete({minLength:1,source:function(a,b){$.ajax({url:"/ajax/university/json",data:{search:a.term},dataType:"json",type:"GET",success:function(a){b(a)}})},select:function(a,b){a.preventDefault();$(this).val(b.item.name);$(this).siblings('input[name="education_id[]"]').val(b.item.id)}});for(i=0;i<$(".university-autocomplete").length;i++)$($(".university-autocomplete")[i]).data("ui-autocomplete")._renderItem=
function(a,b){return $("<li>").append("<a>"+b.name+'<br /><span style="font-size: 12px;">'+b.address+"</span></a>").appendTo(a)};$(".major-autocomplete").autocomplete({minLength:1,source:function(a,b){$.ajax({url:"/ajax/major/json",data:{search:a.term},dataType:"json",type:"GET",success:function(a){b(a)}})},select:function(a,b){a.preventDefault();$(this).val(b.item.title);$(this).siblings('input[name="major_id[]"]').val(b.item.id)}});for(i=0;i<$(".major-autocomplete").length;i++)$($(".major-autocomplete")[i]).data("ui-autocomplete")._renderItem=
function(a,b){return $("<li>").append("<a>"+b.title+"</a>").appendTo(a)}};$(document).on("click",".join-cg",function(){var a=this.getAttribute("data-what"),a="/ajax/"+a+"/join",b=this.getAttribute("data-id");$(this).hide();$.ajax({url:a,type:"POST",data:{id:b}}).done(function(a){$("h2.count-members").text(parseInt($("h2.count-members").text())+1)})});
