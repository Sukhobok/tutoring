var paths=[],styles=[{strokeColor:"#ed1c24",strokeWidth:2},{strokeColor:"#ed1c24",strokeWidth:2}];project.layers[0].redoChildren=[];
var tsUndo=function(){null!==project.activeLayer.lastChild&&(project.activeLayer.redoChildren.push(project.activeLayer.lastChild),project.activeLayer.lastChild.remove(),project.view.update())},tsRedo=function(){if(0!==project.activeLayer.redoChildren.length){var b=project.activeLayer.redoChildren.pop();project.activeLayer.addChild(b);project.view.update()}},tsClear=function(){project.activeLayer.removeChildren();project.view.update()};var pencilTool=new Tool;pencilTool.minDistance=10;pencilTool.onMouseDown=function(b,a){a="undefined"!==typeof a?a:0;paths[a]=new Path;paths[a].style=styles[a];paths[a].add(b.point);0==a&&"undefined"!==typeof ts_socket&&mouseCatch(b,"pencilTool")};pencilTool.onMouseDrag=function(b,a){a="undefined"!==typeof a?a:0;paths[a].add(b.point);paths[a].smooth();0==a&&"undefined"!==typeof ts_socket&&mouseCatch(b,"pencilTool")};var eraseTool=new Tool;eraseTool.minDistance=10;eraseTool.onMouseDown=function(b,a){a="undefined"!==typeof a?a:0;paths[a]=new Path;paths[a].originalColor=styles[a].strokeColor;styles[a].strokeColor="#fff";paths[a].style=styles[a];paths[a].add(b.point);0==a&&"undefined"!==typeof ts_socket&&mouseCatch(b,"eraseTool")};eraseTool.onMouseDrag=function(b,a){a="undefined"!==typeof a?a:0;paths[a].add(b.point);paths[a].smooth();0==a&&"undefined"!==typeof ts_socket&&mouseCatch(b,"eraseTool")};
eraseTool.onMouseUp=function(b,a){a="undefined"!==typeof a?a:0;paths[a].add(b.point);paths[a].smooth();styles[a].strokeColor=paths[a].originalColor;0==a&&"undefined"!==typeof ts_socket&&mouseCatch(b,"eraseTool")};var rectangleTool=new Tool;rectangleTool.minDistance=10;rectangleTool.onMouseDown=function(b,a){a="undefined"!==typeof a?a:0;paths[a]=new Path;paths[a].style=styles[a];paths[a].startingPoint=b.point;0==a&&"undefined"!==typeof ts_socket&&mouseCatch(b,"rectangleTool")};
rectangleTool.onMouseDrag=function(b,a){a="undefined"!==typeof a?a:0;var d=paths[a];paths[a].remove();paths[a]=new Path.Rectangle(d.startingPoint,b.point);paths[a].style=styles[a];paths[a].startingPoint=d.startingPoint;0==a&&"undefined"!==typeof ts_socket&&mouseCatch(b,"rectangleTool")};var ellipseTool=new Tool;ellipseTool.minDistance=10;ellipseTool.onMouseDown=function(b,a){a="undefined"!==typeof a?a:0;paths[a]=new Path;paths[a].style=styles[a];paths[a].startingPoint=b.point;0==a&&"undefined"!==typeof ts_socket&&mouseCatch(b,"ellipseTool")};
ellipseTool.onMouseDrag=function(b,a){a="undefined"!==typeof a?a:0;var d=paths[a];paths[a].remove();var e=new Rectangle(d.startingPoint,b.point);paths[a]=new Path.Ellipse(e);paths[a].style=styles[a];paths[a].startingPoint=d.startingPoint;0==a&&"undefined"!==typeof ts_socket&&mouseCatch(b,"ellipseTool")};var lineTool=new Tool;lineTool.minDistance=10;lineTool.onMouseDown=function(b,a){a="undefined"!==typeof a?a:0;paths[a]=new Path;paths[a].style=styles[a];paths[a].startingPoint=b.point;0==a&&"undefined"!==typeof ts_socket&&mouseCatch(b,"lineTool")};
lineTool.onMouseDrag=function(b,a){a="undefined"!==typeof a?a:0;var d=paths[a];paths[a].remove();paths[a]=new Path.Line(d.startingPoint,b.point);paths[a].style=styles[a];paths[a].startingPoint=d.startingPoint;0==a&&"undefined"!==typeof ts_socket&&mouseCatch(b,"lineTool")};var tsAddTab=function(){var b=parseInt($(".ts-whiteboard-tab").last()[0].getAttribute("data-ts-tab-id"));if(6>b){$(".ts-whiteboard-tab").removeClass("is-selected");var a=$(".ts-whiteboard-tab").first().clone();a.text("Tab "+(b+2));a[0].setAttribute("data-ts-tab-id",b+1);a.addClass("is-selected");$(".ts-whiteboard-tabs-holder").append(a);project.layers[b+1]=new Layer;project.layers[b+1].redoChildren=[];activateLayer(b+1)}},tsRemoveTab=function(){var b=parseInt($(".ts-whiteboard-tab").last()[0].getAttribute("data-ts-tab-id"));
0!==b&&($(".ts-whiteboard-tab").last().hasClass("is-selected")&&($(".ts-whiteboard-tab").eq(-2).addClass("is-selected"),activateLayer(b-1)),$(".ts-whiteboard-tab").last().remove(),project.layers[b].remove())},tsFocusTab=function(b){$(".ts-whiteboard-tab").removeClass("is-selected");$('.ts-whiteboard-tab[data-ts-tab-id="'+b+'"]').addClass("is-selected");activateLayer(b)},activateLayer=function(b){for(_i=0;_i<project.layers.length;_i++)project.layers[_i].visible=!1;project.layers[b].visible=!0;project.layers[b].activate();
project.view.update()};$(document).on("click",".ts-whiteboard-tools-colors",function(){36==$(this).width()?$(this).animate({width:311}):$(this).animate({width:36})});
$(document).on("click",".ts-whiteboard-tools-color",function(){var b;b="ts-whiteboard-tools-color-"+this.getAttribute("data-ts-color-name");var a=this.getAttribute("data-ts-color-name"),d=this.getAttribute("data-ts-color"),e;e="ts-whiteboard-tools-color-"+$(".ts-whiteboard-tools-color").first()[0].getAttribute("data-ts-color-name");var c=$(".ts-whiteboard-tools-color").first()[0].getAttribute("data-ts-color-name"),f=$(".ts-whiteboard-tools-color").first()[0].getAttribute("data-ts-color");$(".ts-whiteboard-tools-color").first().removeClass(e).addClass(b);
$(".ts-whiteboard-tools-color").first()[0].setAttribute("data-ts-color-name",a);$(".ts-whiteboard-tools-color").first()[0].setAttribute("data-ts-color",d);$(this).removeClass(b).addClass(e);$(this)[0].setAttribute("data-ts-color-name",c);$(this)[0].setAttribute("data-ts-color",f);styles[0].strokeColor=d;ts_socket.emit("tutoring_session_data",{what:"wb_style",type:"color",value:d})});$(document).on("click",".ts-whiteboard-tools-sizes",function(){36==$(this).width()?$(this).animate({width:233}):$(this).animate({width:36})});
$(document).on("click",".ts-whiteboard-tools-size",function(){var b=parseInt(this.getAttribute("data-ts-size")),a=parseInt($(".ts-whiteboard-tools-size").first()[0].getAttribute("data-ts-size"));$(".ts-whiteboard-tools-size").first()[0].setAttribute("data-ts-size",b);$(".ts-whiteboard-tools-size").first().text(b+"px");this.setAttribute("data-ts-size",a);$(this).text(a+"px");styles[0].strokeWidth=b;ts_socket.emit("tutoring_session_data",{what:"wb_style",type:"size",value:b})});var Player=function(b,a,d,e){var c=this;c.start_position=b;c.position=b;c.end_position=a;c.duration=c.end_position-c.start_position;c.looper=null;c.last_item=0;c.play=function(){c.looper=setInterval(function(){for(i=c.position;i<c.position+100;i++)for(;c.last_item!=_data.length-1&&_data[c.last_item].t<=i;){if(_data[c.last_item].t==i){var a=JSON.parse(_data[c.last_item].d);if("object"===typeof a)switch(a.what){case "draw":a.e.point=new Point(a.e.point[1],a.e.point[2]);switch(a.tool){case "pencil":switch(a.ev){case "mousedrag":pencilTool.onMouseDrag(a.e,
_data[0].u==_data[c.last_item].u?0:1);break;case "mousedown":pencilTool.onMouseDown(a.e,_data[0].u==_data[c.last_item].u?0:1);break;case "mouseup":pencilTool.onMouseUp(a.e,_data[0].u==_data[c.last_item].u?0:1)}break;case "erase":switch(a.ev){case "mousedrag":eraseTool.onMouseDrag(a.e,_data[0].u==_data[c.last_item].u?0:1);break;case "mousedown":eraseTool.onMouseDown(a.e,_data[0].u==_data[c.last_item].u?0:1);break;case "mouseup":eraseTool.onMouseUp(a.e,_data[0].u==_data[c.last_item].u?0:1)}break;case "rectangle":switch(a.ev){case "mousedrag":rectangleTool.onMouseDrag(a.e,
_data[0].u==_data[c.last_item].u?0:1);break;case "mousedown":rectangleTool.onMouseDown(a.e,_data[0].u==_data[c.last_item].u?0:1);break;case "mouseup":rectangleTool.onMouseUp(a.e,_data[0].u==_data[c.last_item].u?0:1)}break;case "ellipse":switch(a.ev){case "mousedrag":ellipseTool.onMouseDrag(a.e,_data[0].u==_data[c.last_item].u?0:1);break;case "mousedown":ellipseTool.onMouseDown(a.e,_data[0].u==_data[c.last_item].u?0:1);break;case "mouseup":ellipseTool.onMouseUp(a.e,_data[0].u==_data[c.last_item].u?
0:1)}break;default:switch(a.ev){case "mousedrag":lineTool.onMouseDrag(a.e,_data[0].u==_data[c.last_item].u?0:1);break;case "mousedown":lineTool.onMouseDown(a.e,_data[0].u==_data[c.last_item].u?0:1);break;case "mouseup":lineTool.onMouseUp(a.e,_data[0].u==_data[c.last_item].u?0:1)}}project.view.update();break;case "wb_style":switch(a.type){case "color":styles[_data[0].u==_data[c.last_item].u?0:1].strokeColor=a.value;break;case "size":styles[_data[0].u==_data[c.last_item].u?0:1].strokeWidth=a.value}break;
case "chat":tsChatAdd(a.message,_data[0].u==_data[c.last_item].u?0:1);break;case "mode":tsSelectMode(a.mode);break;case "wb_tabs":switch(a.action){case "add":tsAddTab();break;case "remove":tsRemoveTab();break;case "focus":tsFocusTab(a.tab_id)}break;case "wb_actions":switch(a.action){case "undo":tsUndo();break;case "redo":tsRedo();break;case "clear":tsClear()}break;case "coding":switch(a.action){case "change_language":tsCodingChangeLang(a.value);break;case "change_template":tsCodingChangeTemplate(a.value);
break;case "action":tsCodingAction(a.value);break;case "data":tsCodingEditor.setValue(a.value.code_data),tsCodingEditor.gotoLine(a.value.cursor_at.row+1,a.value.cursor_at.column)}break;case "text":tsTextReceive(a.value)}}c.last_item++}c.position+=100;c.position>=c.end_position&&c.stop()},100)};c.pause=function(){clearInterval(c.looper)};c.stop=function(){clearInterval(c.looper);c.position=c.start_position}},p=new Player(_started_at,_ended_at,1,1);
$("#ss-action-play").click(function(){"ll"==this.innerHTML?(this.innerHTML="&#9658;",p.pause(),$("#action_stop_whiteboard").hide()):(this.innerHTML="ll",p.play(),$("#action_stop_whiteboard").show())});$("#ss-action-stop").click(function(){p.stop();$("#ss-action-stop").hide();$("#ss-action-play").html("&#9658;")});
