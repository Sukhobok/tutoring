var mouseCatch=function(b,a){var c="";switch(a){case "ellipseTool":c="ellipse";break;case "eraseTool":c="erase";break;case "lineTool":c="line";break;case "pencilTool":c="pencil";break;case "rectangleTool":c="rectangle"}ts_socket.emit("tutoring_session_data",{what:"draw",tool:c,e:{point:b.point},ev:b.type})};var paths=[],styles=[{strokeColor:"#ed1c24",strokeWidth:2},{strokeColor:"#ed1c24",strokeWidth:2}];project.layers[0].redoChildren=[];
var tsUndo=function(){null!==project.activeLayer.lastChild&&(project.activeLayer.redoChildren.push(project.activeLayer.lastChild),project.activeLayer.lastChild.remove(),project.view.update())},tsRedo=function(){if(0!==project.activeLayer.redoChildren.length){var b=project.activeLayer.redoChildren.pop();project.activeLayer.addChild(b);project.view.update()}},tsClear=function(){project.activeLayer.removeChildren();project.view.update()};var pencilTool=new Tool;pencilTool.minDistance=10;pencilTool.onMouseDown=function(b,a){a="undefined"!==typeof a?a:0;paths[a]=new Path;paths[a].style=styles[a];paths[a].add(b.point);0==a&&"undefined"!==typeof ts_socket&&mouseCatch(b,"pencilTool")};pencilTool.onMouseDrag=function(b,a){a="undefined"!==typeof a?a:0;paths[a].add(b.point);paths[a].smooth();0==a&&"undefined"!==typeof ts_socket&&mouseCatch(b,"pencilTool")};var eraseTool=new Tool;eraseTool.minDistance=10;eraseTool.onMouseDown=function(b,a){a="undefined"!==typeof a?a:0;paths[a]=new Path;paths[a].originalColor=styles[a].strokeColor;styles[a].strokeColor="#fff";paths[a].style=styles[a];paths[a].add(b.point);0==a&&"undefined"!==typeof ts_socket&&mouseCatch(b,"eraseTool")};eraseTool.onMouseDrag=function(b,a){a="undefined"!==typeof a?a:0;paths[a].add(b.point);paths[a].smooth();0==a&&"undefined"!==typeof ts_socket&&mouseCatch(b,"eraseTool")};
eraseTool.onMouseUp=function(b,a){a="undefined"!==typeof a?a:0;paths[a].add(b.point);paths[a].smooth();styles[a].strokeColor=paths[a].originalColor;0==a&&"undefined"!==typeof ts_socket&&mouseCatch(b,"eraseTool")};var rectangleTool=new Tool;rectangleTool.minDistance=10;rectangleTool.onMouseDown=function(b,a){a="undefined"!==typeof a?a:0;paths[a]=new Path;paths[a].style=styles[a];paths[a].startingPoint=b.point;0==a&&"undefined"!==typeof ts_socket&&mouseCatch(b,"rectangleTool")};
rectangleTool.onMouseDrag=function(b,a){a="undefined"!==typeof a?a:0;var c=paths[a];paths[a].remove();paths[a]=new Path.Rectangle(c.startingPoint,b.point);paths[a].style=styles[a];paths[a].startingPoint=c.startingPoint;0==a&&"undefined"!==typeof ts_socket&&mouseCatch(b,"rectangleTool")};var ellipseTool=new Tool;ellipseTool.minDistance=10;ellipseTool.onMouseDown=function(b,a){a="undefined"!==typeof a?a:0;paths[a]=new Path;paths[a].style=styles[a];paths[a].startingPoint=b.point;0==a&&"undefined"!==typeof ts_socket&&mouseCatch(b,"ellipseTool")};
ellipseTool.onMouseDrag=function(b,a){a="undefined"!==typeof a?a:0;var c=paths[a];paths[a].remove();var d=new Rectangle(c.startingPoint,b.point);paths[a]=new Path.Ellipse(d);paths[a].style=styles[a];paths[a].startingPoint=c.startingPoint;0==a&&"undefined"!==typeof ts_socket&&mouseCatch(b,"ellipseTool")};var lineTool=new Tool;lineTool.minDistance=10;lineTool.onMouseDown=function(b,a){a="undefined"!==typeof a?a:0;paths[a]=new Path;paths[a].style=styles[a];paths[a].startingPoint=b.point;0==a&&"undefined"!==typeof ts_socket&&mouseCatch(b,"lineTool")};
lineTool.onMouseDrag=function(b,a){a="undefined"!==typeof a?a:0;var c=paths[a];paths[a].remove();paths[a]=new Path.Line(c.startingPoint,b.point);paths[a].style=styles[a];paths[a].startingPoint=c.startingPoint;0==a&&"undefined"!==typeof ts_socket&&mouseCatch(b,"lineTool")};var tsAddTab=function(){var b=parseInt($(".ts-whiteboard-tab").last()[0].getAttribute("data-ts-tab-id"));if(6>b){$(".ts-whiteboard-tab").removeClass("is-selected");var a=$(".ts-whiteboard-tab").first().clone();a.text("Tab "+(b+2));a[0].setAttribute("data-ts-tab-id",b+1);a.addClass("is-selected");$(".ts-whiteboard-tabs-holder").append(a);project.layers[b+1]=new Layer;project.layers[b+1].redoChildren=[];activateLayer(b+1)}},tsRemoveTab=function(){var b=parseInt($(".ts-whiteboard-tab").last()[0].getAttribute("data-ts-tab-id"));
0!==b&&($(".ts-whiteboard-tab").last().hasClass("is-selected")&&($(".ts-whiteboard-tab").eq(-2).addClass("is-selected"),activateLayer(b-1)),$(".ts-whiteboard-tab").last().remove(),project.layers[b].remove())},tsFocusTab=function(b){$(".ts-whiteboard-tab").removeClass("is-selected");$('.ts-whiteboard-tab[data-ts-tab-id="'+b+'"]').addClass("is-selected");activateLayer(b)},activateLayer=function(b){for(i=0;i<project.layers.length;i++)project.layers[i].visible=!1;project.layers[b].visible=!0;project.layers[b].activate();
project.view.update()};var selectTool=function(b){$(".ts-whiteboard-tool").removeClass("is-selected");$(".ts-whiteboard-tools-"+b).addClass("is-selected");switch(b){case "pencil":pencilTool.activate();break;case "erase":eraseTool.activate();break;case "rectangle":rectangleTool.activate();break;case "ellipse":ellipseTool.activate();break;default:lineTool.activate()}};$(document).on("click",".ts-whiteboard-tools-pencil",function(){selectTool("pencil")});$(document).on("click",".ts-whiteboard-tools-erase",function(){selectTool("erase")});
$(document).on("click",".ts-whiteboard-tools-rectangle",function(){selectTool("rectangle")});$(document).on("click",".ts-whiteboard-tools-ellipse",function(){selectTool("ellipse")});$(document).on("click",".ts-whiteboard-tools-line",function(){selectTool("line")});$(document).on("click",".ts-whiteboard-undo",function(){tsUndo();ts_socket.emit("tutoring_session_data",{what:"wb_actions",action:"undo"})});
$(document).on("click",".ts-whiteboard-redo",function(){tsRedo();ts_socket.emit("tutoring_session_data",{what:"wb_actions",action:"redo"})});$(document).on("click",".ts-whiteboard-clear",function(){tsClear();ts_socket.emit("tutoring_session_data",{what:"wb_actions",action:"clear"})});$(document).on("click","#ts-whiteboard-tab-add",function(){tsAddTab();ts_socket.emit("tutoring_session_data",{what:"wb_tabs",action:"add"})});
$(document).on("click",".ts-whiteboard-tools-remove-tab",function(){tsRemoveTab();ts_socket.emit("tutoring_session_data",{what:"wb_tabs",action:"remove"})});$(document).on("click",".ts-whiteboard-tab",function(){tsFocusTab(this.getAttribute("data-ts-tab-id"));ts_socket.emit("tutoring_session_data",{what:"wb_tabs",action:"focus",tab_id:this.getAttribute("data-ts-tab-id")})});$(document).on("click",".ts-whiteboard-tools-colors",function(){36==$(this).width()?$(this).animate({width:311}):$(this).animate({width:36})});
$(document).on("click",".ts-whiteboard-tools-color",function(){var b;b="ts-whiteboard-tools-color-"+this.getAttribute("data-ts-color-name");var a=this.getAttribute("data-ts-color-name"),c=this.getAttribute("data-ts-color"),d;d="ts-whiteboard-tools-color-"+$(".ts-whiteboard-tools-color").first()[0].getAttribute("data-ts-color-name");var e=$(".ts-whiteboard-tools-color").first()[0].getAttribute("data-ts-color-name"),f=$(".ts-whiteboard-tools-color").first()[0].getAttribute("data-ts-color");$(".ts-whiteboard-tools-color").first().removeClass(d).addClass(b);
$(".ts-whiteboard-tools-color").first()[0].setAttribute("data-ts-color-name",a);$(".ts-whiteboard-tools-color").first()[0].setAttribute("data-ts-color",c);$(this).removeClass(b).addClass(d);$(this)[0].setAttribute("data-ts-color-name",e);$(this)[0].setAttribute("data-ts-color",f);styles[0].strokeColor=c;ts_socket.emit("tutoring_session_data",{what:"wb_style",type:"color",value:c})});$(document).on("click",".ts-whiteboard-tools-sizes",function(){36==$(this).width()?$(this).animate({width:233}):$(this).animate({width:36})});
$(document).on("click",".ts-whiteboard-tools-size",function(){var b=parseInt(this.getAttribute("data-ts-size")),a=parseInt($(".ts-whiteboard-tools-size").first()[0].getAttribute("data-ts-size"));$(".ts-whiteboard-tools-size").first()[0].setAttribute("data-ts-size",b);$(".ts-whiteboard-tools-size").first().text(b+"px");this.setAttribute("data-ts-size",a);$(this).text(a+"px");styles[0].strokeWidth=b;ts_socket.emit("tutoring_session_data",{what:"wb_style",type:"size",value:b})});ts_socket.on("tutoring_session_data",function(b){console.log(b);if("object"===typeof b)switch(b.what){case "draw":b.e.point=new Point(b.e.point[1],b.e.point[2]);switch(b.tool){case "pencil":switch(b.ev){case "mousedrag":pencilTool.onMouseDrag(b.e,1);break;case "mousedown":pencilTool.onMouseDown(b.e,1);break;case "mouseup":pencilTool.onMouseUp(b.e,1)}break;case "erase":switch(b.ev){case "mousedrag":eraseTool.onMouseDrag(b.e,1);break;case "mousedown":eraseTool.onMouseDown(b.e,1);break;case "mouseup":eraseTool.onMouseUp(b.e,
1)}break;case "rectangle":switch(b.ev){case "mousedrag":rectangleTool.onMouseDrag(b.e,1);break;case "mousedown":rectangleTool.onMouseDown(b.e,1);break;case "mouseup":rectangleTool.onMouseUp(b.e,1)}break;case "ellipse":switch(b.ev){case "mousedrag":ellipseTool.onMouseDrag(b.e,1);break;case "mousedown":ellipseTool.onMouseDown(b.e,1);break;case "mouseup":ellipseTool.onMouseUp(b.e,1)}break;default:switch(b.ev){case "mousedrag":lineTool.onMouseDrag(b.e,1);break;case "mousedown":lineTool.onMouseDown(b.e,
1);break;case "mouseup":lineTool.onMouseUp(b.e,1)}}project.view.update();break;case "wb_style":switch(b.type){case "color":styles[1].strokeColor=b.value;break;case "size":styles[1].strokeWidth=b.value}break;case "chat":tsChatAdd(b.message);break;case "mode":tsSelectMode(b.mode);break;case "wb_tabs":switch(b.action){case "add":tsAddTab();break;case "remove":tsRemoveTab();break;case "focus":tsFocusTab(b.tab_id)}break;case "wb_actions":switch(b.action){case "undo":tsUndo();break;case "redo":tsRedo();
break;case "clear":tsClear()}break;case "coding":switch(b.action){case "change_language":tsCodingChangeLang(b.value);break;case "change_template":tsCodingChangeTemplate(b.value);break;case "action":tsCodingAction(b.value);break;case "data":tsCodingEditor.setValue(b.value.code_data),tsCodingEditor.gotoLine(b.value.cursor_at.row+1,b.value.cursor_at.column)}break;case "text":tsTextReceive(b.value)}});
